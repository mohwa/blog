<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <!-- viewport 설정 -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- keyword 설정 -->
    
    <!-- description 설정 -->
    

    <!-- open graph 설정 -->
    <meta property="og:type" content="mohwa blog">
    
    
    <!--<meta property="og:image" content="http://mysite.com/myimage.jpg">-->
    <meta property="og:url" content="/blog">

    <meta name="copyright" content="by mohwa" />

    <!--<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon" />-->

    <!-- google search console 설정 -->
    <link rel="alternate" hreflang="ko" href="http://mohwa.github.io" />
    <link rel="alternate" hreflang="ko" href="https://mohwa.github.io" />

    <link rel="stylesheet" href="/blog/assets/css/site.css" />
    <link rel="stylesheet" href="/blog/bower_components/highlightjs/styles/darkula.css">

    <script src="/blog/bower_components/jquery/dist/jquery.min.js" type="text/javascript"></script>
    <script src="/blog/bower_components/highlightjs/highlight.pack.min.js" type="text/javascript"></script>
    <script src="/blog/bower_components/purl/purl.js" type="text/javascript"></script>
    <!-- Script pointing to jekyll-search.js -->
    <script src="/blog/bower_components/simple-jekyll-search/dest/jekyll-search.js" type="text/javascript"></script>

    <title>Mohwa blog</title>

    <script type="text/javascript">

        // code highlight 적용
        // https://highlightjs.org/static/demo/
        $(document).ready(function() {
            $('pre code').each(function(i, block) {
                hljs.highlightBlock(block);
            });
        });
    </script>
</head>

<body>

  <div class="top-bar"></div>

  <div class="container">
    <div class="site">
      <header>
        <nav>
    <span style="float:left;">
        <a class="" href="/blog/">Home</a>
        <!--<a class="" href="/archive/">전체글</a>-->
        <!--<a class="" href="//github.com/nolboo/nolboo.github.io/wiki">번역글 위키</a>-->
    </span>
    <span style="float:right;">
        <div id="search-container" class="search-container">
            <input type="text" id="search-input" class="search-input" placeholder="search...">
        </div>
    </span>
</nav>

        <div class="pull-right right logo">
          <div class="name"></div>
          <!--<a href="/feed.xml"><img class="avatar" src="/images/rss.jpg" alt="RSS" /></a>-->
        </div>
      </header>
      <div class="separator"></div>
      <ul id="results-container" class="results-container"></ul>
      <!-- ./_layouts/default.html 파일에 정의된  영역으로 아래 내용들이 들어간다. -->
<section>
  <ul class="posts">
    <!-- This loops through the paginated posts -->
    
      <li>
          <header class="post-header">
            <h1 itemprop="name" class="post-title">
              <a itemprop="url" class="post-link" href="/blog/javascript/2015/10/14/variable-inJS/">Variable in JS</a>
            </h1>
            <div class="tags cf">
              
                <a href="/blog/search/?category=javascript">javascript</a>&nbsp;
              
              <time itemprop="datePublished" datetime="2015-10-14">
                Oct 14, 2015
              </time>
            </div>
        </header>

        <article style="position: relative; width: 100%; height: 400px; overflow-y: hidden; margin-bottom: 15px;">
          <ul>
<li><p><strong>ECMAScript</strong> 에서 말하는 <strong>변수</strong>는 오직 <span style="color:#6298c1">var</span> 키워드를(또는 변수 선언식을) 통해서만 <strong>선언</strong>된다.</p>

<ul>
<li><p>즉 <span style="color:#6298c1">var</span> 키워드가(또는 변수 선언식이) 생략된 y 속성은, <u><strong>변수가 아닌</strong> <span style="color:#c11f1f">VO</span> 의 <strong>속성</strong>일 뿐이며</u>, Execution Context 진입 시, <span style="color:#c11f1f">VO</span> 의 새로운 <strong>속성</strong>으로 추가되지 않는다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global Execution Context</span>

  <span class="c1">// var 키워드를(변수 선언식을) 통해 변수가 선언되었다.</span>
  <span class="c1">// Execution Context 진입 시 VO 의 새로운 속성으로 추가되며, undefined 로 초기화된다.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// undefined</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// undefined</span>

  <span class="c1">// var 키워드를 통한 변수 선언</span>
  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="k">try</span><span class="p">{</span>

    <span class="c1">// Execution Context 진입 시 VO 의 새로운 속성으로 추가되지않으며, 그에 따라 런타임 에러가 발생한다.</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="nx">ex</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ex</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span> <span class="c1">// y is not defined</span>
  <span class="p">}</span>

  <span class="c1">// var 키워드가(변수 선언식이) 생략된 y 속성</span>
  <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div></li>
<li><p>Execution Context 진입 시 <span style="color:#c11f1f">ECStack</span> 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">globalExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">x</span><span class="o">:</span> <span class="kc">undefined</span>
        <span class="c1">// y 속성은 execution context 진입 시 초기화되지 않는다.</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">];</span>
</code></pre></div></li>
<li><p><strong>실행 코드 처리 후</strong>에는 <span style="color:#c11f1f">VO</span> 의 새로운 <strong>속성</strong>으로 추가된다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global Execution Context</span>

  <span class="c1">// Execution Context 진입 시 VO 의 새로운 속성으로 추가되지않는다.</span>
  <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// 실행 코드</span>

  <span class="c1">// 실행 코드 처리 후에는 VO 의 속성으로 추가된다.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// 2</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// 2</span>
</code></pre></div></li>
<li><p><strong>변수 선언식</strong>을 통해, 생성된 <strong>변수</strong>는 <u>non-configurable</u>(or <strong>DontDelete</strong>) <strong>속성</strong>으로 정의되며, <span style="color:#c11f1f">delete</span> 연산자를 통해 <strong>삭제</strong>되지 않는다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global Execution Context</span>

  <span class="c1">// var 키워드를 통한 x 변수는 non-configurable 속성을 가지고있다.</span>
  <span class="c1">// configurable = false</span>
  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// var 키워드가 생략된 y 속성은 configurable 속성을 가지고있다.</span>
  <span class="c1">// configurable = true</span>
  <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="c1">// Object {value: 1, writable: true, enumerable: true, configurable: false}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyDescriptor</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">));</span>

  <span class="c1">// Object {value: 2, writable: true, enumerable: true, configurable: true}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyDescriptor</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">));</span>

  <span class="c1">// delete 연산자를 통해 x 변수를 삭제한다.</span>
  <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>

  <span class="c1">// delete 연산자를 통해 y 속성을 삭제한다.</span>
  <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>

  <span class="c1">// x 변수는 non-configurable 속성으로 delete 연산자를 통해, 삭제되지 않는다.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 1</span>

  <span class="c1">// y 속성은 configurable 속성으로 delete 연산자를 통해, 삭제된다.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// undefined</span>
</code></pre></div></li>
<li><p><span style="color:#6298c1">eval</span> 함수를 통해, 선언된 <strong>변수</strong>는 <strong>변수</strong>로 선언되지 않는다.(<span style="color:#c11f1f">VO</span> 의 <strong>속성</strong>으로 추가되며, <strong>configuration</strong> 속성으로 정의된다)</p>

<ul>
<li><p>변수가 아닌, <span style="color:#c11f1f">VO</span> 의 <strong>속성</strong>으로 추가된다</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global Execution Context</span>

<span class="c1">// calling context 는 global Execution Context 를 가리킨다.</span>

<span class="c1">// eval 함수를 통해 x 변수를 생성한다.</span>
<span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;var x = 1&#39;</span><span class="p">);</span>

<span class="c1">// 정의된 객체 속성을 나열한다.(x 속성은 configurable 속성으로 정의되어있다)</span>

<span class="c1">// Object {value: 1, writable: true, enumerable: true, configurable: true}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyDescriptor</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">));</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 1</span>

<span class="c1">// delete 연산자를 통해 x 속성을 삭제한다.</span>
<span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>

<span class="c1">// 변수가 아닌, VO 의 x 속성은 delete 연산자를 통해 삭제된다.</span>
<span class="c1">// 즉 configurable 속성으로 정의되었으며, 변수로 선언되지 않았다.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// undefined</span>
</code></pre></div></li>
<li><p>Function Execution Context 의 eval 함수</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global execution context</span>

<span class="kd">function</span> <span class="nx">A</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// function execution context</span>

    <span class="c1">// calling context 는 function execution context 를 가리킨다.</span>

    <span class="c1">// x 지역 변수를 선언한다.</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// eval 함수를 통해, 변수를 선언한다.</span>
    <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;var y = 2;&#39;</span><span class="p">);</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 1</span>

    <span class="c1">// y 속성은 calling context 내부 VO 에 추가된다.</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// 2</span>

    <span class="c1">// x 변수를 delete 연산자를 통해 삭제한다.</span>
    <span class="k">delete</span> <span class="nx">x</span><span class="p">;</span>
    <span class="c1">// y 속성을 delete 연산자를 통해 삭제한다.</span>
    <span class="k">delete</span> <span class="nx">y</span><span class="p">;</span>

    <span class="c1">// x 변수는 delete 연산자를 통해, 삭제되지 않는다.</span>
    <span class="c1">// 즉 x 변수는 변수로 선언되었다.(DontDelete 속성)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 1</span>

    <span class="c1">// delete 연산자를 통해, 해당 속성이 삭제되었다.</span>
    <span class="c1">// 즉 y 속성은 변수로 선언되지 않았다.</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// Uncaught ReferenceError: y is not defined</span>
<span class="p">}</span>

<span class="nx">A</span><span class="p">();</span>
</code></pre></div></li>
<li><p><span style="color:#c11f1f">ECStack</span> 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
  <span class="nx">evalExecutionContext</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span>
    <span class="p">}</span>
  <span class="p">},</span>                
  <span class="c1">// 호출 문맥</span>
  <span class="nx">callingContext</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="p">,</span>
  <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>            
      <span class="c1">// 실행 코드 처리 후, x 변수에 1이 할당된다.      </span>
      <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">// --&gt; delete 연산자를 통해 삭제되지 않는다. --&gt; 1</span>
      <span class="c1">// eval 함수로 전달된 실행 코드로 인해, calling context 내부 VO 가 영향받는다.</span>
      <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span> <span class="c1">// --&gt; delete 연산자를 통해 삭제된다. --&gt; y is not defined</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">globalExecutionContext</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">];</span>
</code></pre></div></li>
</ul></li>
</ul></li>
</ul>

<h2 id="url">참고 URL</h2>

<ul>
<li><p><a href="http://mohwa.github.io/blog/javascript/2015/10/14/vo-inJS/">Variable Object in JS</a></p></li>
<li><p><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/var">var</a></p></li>
<li><p><a href="http://huns.me/development/189">ECMA-262-3 in detail. Chapter 2. Variable object 번역 글</a></p></li>
<li><p><a href="https://msdn.microsoft.com/en-us/library/br230269(v=vs.94).aspx">Strict Mode (JavaScript)</a></p></li>
<li><p><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Guide/Obsolete_Pages/Core_JavaScript_1.5_Guide/Operators/Special_Operators#delete">Special Operators</a></p></li>
</ul>

        </article>
        <p style="text-align: right"><a href="/blog/javascript/2015/10/14/variable-inJS/">Read more</a></p>
        <hr style="margin-bottom:30px; border:0; border-bottom: 1px dotted #ccc;" />
    </li>
  
      <li>
          <header class="post-header">
            <h1 itemprop="name" class="post-title">
              <a itemprop="url" class="post-link" href="/blog/javascript/2015/10/14/this-inJS/">This in JS</a>
            </h1>
            <div class="tags cf">
              
                <a href="/blog/search/?category=javascript">javascript</a>&nbsp;
              
              <time itemprop="datePublished" datetime="2015-10-14">
                Oct 14, 2015
              </time>
            </div>
        </header>

        <article style="position: relative; width: 100%; height: 400px; overflow-y: hidden; margin-bottom: 15px;">
          <ul>
<li><p><span style="color:#6298c1">this</span> 값은 Execution Context 의 <strong>속성</strong> 중 하나이다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
  <span class="nx">globalExecutionContext</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
    <span class="p">},</span>
    <span class="k">this</span><span class="o">:</span> <span class="nx">global</span> <span class="nx">object</span>
  <span class="p">}</span>
<span class="p">];</span>
</code></pre></div>
<p><img src="https://www.dropbox.com/s/qwq6esodeumm7qq/96.jpg?dl=1" alt=""></p></li>
<li><p><span style="color:#6298c1">this</span> 값은 <u>해당 Execution Context <strong>진입 시 초기화</strong>된 후</u>, 그 <strong>값</strong>이 변하지 않는다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global Execution Context</span>

<span class="c1">// 실행 코드 처리 시 새로운 값을 할당할 수 없다.</span>
<span class="k">this</span><span class="p">.</span><span class="nb">window</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="c1">// 실행 코드 처리 후 값이 변하지 않는다.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nb">window</span><span class="p">);</span> <span class="c1">// global object</span>
</code></pre></div></li>
<li><p>레퍼런스 타입(Reference Type)</p>

<ul>
<li><p><strong>레퍼런스 타입</strong>은 base 와 propertyName <strong>속성</strong>을 가진 <strong>객체</strong>로 표현할 수 있으며, 설명을 목적으로 <strong>&quot;ECMA 스펙&quot;</strong> 에서 정의하고 있는 <strong>개념</strong>이다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="c1">// 아래는 레퍼런스 타입을 나타내는 pseudo-code 이다.</span>
    <span class="kd">var</span> <span class="nx">valueOfReferenceType</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">base</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">base</span> <span class="nx">object</span><span class="o">&gt;</span><span class="p">,</span>
      <span class="nx">propertyName</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">property</span> <span class="nx">name</span><span class="o">&gt;</span>
    <span class="p">};</span>
</code></pre></div></li>
<li><p><strong>레퍼런스 타입</strong>은 오직 두 가지 경우에만 있을 수 있다.</p>

<ul>
<li><p><a href="http://www.devholic.net/1000687">식별자(identifier)</a></p>

<ul>
<li>식별자는 <strong>변수 이름</strong>, <strong>함수 이름</strong>, <strong>함수 Argument 이름</strong>으로 나뉜다.</li>
<li><p>변수 이름</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global Execution Context</span>

  <span class="c1">// A 변수 선언</span>
  <span class="kd">var</span> <span class="nx">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">A</span><span class="p">);</span> <span class="c1">// 1              </span>
</code></pre></div></li>
<li><p>레퍼런스 타입 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">AReference</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">base</span><span class="o">:</span> <span class="nx">global</span> <span class="nx">object</span><span class="p">,</span>
    <span class="nx">propertyName</span><span class="o">:</span> <span class="s1">&#39;A&#39;</span>
  <span class="p">};</span>
</code></pre></div></li>
<li><p>함수 이름</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global Execution Context</span>

<span class="c1">// A 함수 선언</span>
<span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

<span class="p">};</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">A</span><span class="p">);</span> <span class="c1">// A function object</span>
</code></pre></div></li>
<li><p>레퍼런스 타입 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">AReference</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">base</span><span class="o">:</span> <span class="nx">global</span> <span class="nx">object</span><span class="p">,</span>
    <span class="nx">propertyName</span><span class="o">:</span> <span class="s1">&#39;A&#39;</span>
  <span class="p">};</span>
</code></pre></div></li>
<li><p><a href="https://es5.github.io/#x8.7.1">GetValue</a> 메서드</p>

<ul>
<li><p><u><strong>객체</strong>(레퍼런스 타입)의 실제 값을 얻기 위해 사용되는 <span style="color:#6298c1">GetValue</span> 메소드가 존재하며</u>, 이 메서드는 <strong>프로토타입 체인</strong>을 통해, 상속된 <strong>속성</strong>까지 모두 분석 후, <strong>객체 속성</strong>(propertyName)의 실제 값을 <strong>반환</strong>해준다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// GetValue 메서드를 나타내는 pseudo-code 이다.</span>
  <span class="kd">function</span> <span class="nx">GetValue</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">Type</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nx">Reference</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 레퍼런스 타입이 아니면 값을 그대로 돌려준다.</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// base 속성 값을 가져온다.</span>
    <span class="kd">var</span> <span class="nx">base</span> <span class="o">=</span> <span class="nx">GetBase</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>

    <span class="c1">// base 속성 값이 null 인 경우</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">base</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">ReferenceError</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// propertyName 속성 값을 가져온다.</span>
    <span class="kd">var</span> <span class="nx">propertyName</span> <span class="o">=</span> <span class="nx">GetPropertyName</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>

    <span class="c1">// [[Get]] 메서드는 프로토타입 체인으로부터, 상속된 속성까지 모두 분석 후 속성의 실제 값을 돌려준다.</span>
    <span class="k">return</span> <span class="nx">base</span><span class="p">.[[</span><span class="nx">Get</span><span class="p">]](</span><span class="nx">propertyName</span><span class="p">);</span>

  <span class="p">}</span>

  <span class="nx">GetValue</span><span class="p">(</span><span class="nx">ReferenceType</span><span class="p">);</span>
</code></pre></div></li>
</ul></li>
</ul></li>
<li><p>프로퍼티 접근자(property accessor)</p>

<ul>
<li><p>obj 객체의 A 메서드</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global Execution Context</span>

  <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">A</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">A</span><span class="p">());</span> <span class="c1">// obj Object</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]());</span> <span class="c1">// obj Object</span>
</code></pre></div></li>
<li><p>레퍼런스 타입 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">objAReference</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">base</span><span class="o">:</span> <span class="nx">obj</span> <span class="nb">Object</span><span class="p">,</span>
    <span class="nx">propertyName</span><span class="o">:</span> <span class="s1">&#39;A&#39;</span>
  <span class="p">};</span>
</code></pre></div></li>
<li><p><span style="color:#6298c1">GetValue</span> 메서드를 통해 해당 <strong>속성</strong>(propertyName) 값을 반환한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="nx">GetValue</span><span class="p">(</span><span class="nx">objAReference</span><span class="p">);</span> <span class="c1">// A function object</span>
</code></pre></div></li>
</ul></li>
</ul></li>
</ul></li>
<li><p>전역 코드 안의 <span style="color:#6298c1">this</span> 값</p>

<ul>
<li><p><strong>전역 코드</strong>안의 <span style="color:#6298c1">this</span> 는 <strong>전역 객체</strong> 자신이된다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global code in global Execution Context</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// global object</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nb">window</span><span class="p">);</span> <span class="c1">// global object</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nb">window</span><span class="p">);</span> <span class="c1">// true</span>
</code></pre></div></li>
</ul></li>
<li><p>함수 코드 안의 <span style="color:#6298c1">this</span> 값</p>

<ul>
<li><p><strong>함수 코드</strong>의 경우 <span style="color:#6298c1">this</span> 가 <u>가리키는 <strong>대상</strong>이 매번 달라질 수 있다</u>.</p>

<ul>
<li>Function Execution Context 진입 시 <span style="color:#6298c1">this</span> 가 가지는 <strong>초기화</strong> 값은 <u><strong>호출 표현식 형태</strong>에 의해 달라진다</u>.</li>
<li><p>함수 코드 안의 <span style="color:#6298c1">this</span> 값이 <strong>초기화</strong>되는 과정</p>

<ul>
<li>만약 ()(함수 호출 괄호) 왼편의 (<strong>식별자</strong> 또는 <strong>프로퍼티 접근자</strong>)가 <strong>레퍼런스 타입</strong>일경우, 함수 코드 안의 <span style="color:#6298c1">this</span> 값은 해당 <u><strong>레퍼런스 타입</strong>의 <strong>base</strong> 속성 값으로 <strong>초기화</strong>된다.</u><p></li>
<li>그러나 <strong>레퍼런스 타입</strong>이 아닌 경우, <span style="color:#6298c1">this</span> 값은 자동으로 <span style="color:#6298c1">null</span> 을 갖게되며, <u><span style="color:#6298c1">null</span> 은 <span style="color:#6298c1">this</span> 값으로 <strong>평가</strong>될 수 없기때문에, <strong>암묵적</strong>으로 <strong>전역 객체</strong>로 <strong>변환</strong>된다.</u><p></li>
<li><p>A 함수</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global Execution Context</span>

  <span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

    <span class="c1">// function Execution Context</span>
    <span class="c1">// this 값은 해당 레퍼런스 타입의 base 속성 값으로 초기화된다.</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// global object</span>
  <span class="p">};</span>

  <span class="c1">// [호출자].[propertyName](호출괄호)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">A</span><span class="p">();</span> <span class="c1">// this.A();</span>
</code></pre></div></li>
<li><p>레퍼런스 타입 <strong>체크</strong></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// reference Type</span>
  <span class="kd">var</span> <span class="nx">AReference</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">base</span><span class="o">:</span> <span class="nx">global</span> <span class="nx">object</span><span class="p">,</span>
    <span class="nx">propertyName</span><span class="o">:</span> <span class="s1">&#39;A&#39;</span>
  <span class="p">};</span>

  <span class="c1">// referenceType 값을 반환한다.</span>
  <span class="nx">GetValue</span><span class="p">(</span><span class="nx">AReference</span><span class="p">);</span> <span class="c1">// A function object</span>
</code></pre></div></li>
<li><p>obj 객체의 X 메서드</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global Execution Context</span>

  <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">X</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span> 
  <span class="p">};</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">X</span><span class="p">());</span> <span class="c1">// obj Object</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]());</span> <span class="c1">// obj Object</span>
</code></pre></div></li>
<li><p>레퍼런스 타입 <strong>체크</strong></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// reference Type</span>
  <span class="kd">var</span> <span class="nx">objXReference</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">base</span><span class="o">:</span> <span class="nx">obj</span> <span class="nb">Object</span><span class="p">,</span>
    <span class="nx">propertyName</span><span class="o">:</span> <span class="s1">&#39;X&#39;</span>
  <span class="p">};</span>

  <span class="c1">// referenceType 값을 반환한다.</span>
  <span class="nx">GetValue</span><span class="p">(</span><span class="nx">objXReference</span><span class="p">);</span> <span class="c1">// X function object</span>
</code></pre></div></li>
<li><p>obj 객체의 A 메서드를 x 변수에 <strong>할당</strong>한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global Execution Context</span>

  <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">A</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="c1">// x 변수 선언</span>
  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">A</span><span class="p">;</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">());</span> <span class="c1">// global object</span>
</code></pre></div></li>
<li><p>레퍼런스 타입 <strong>체크</strong></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// reference Type</span>
  <span class="kd">var</span> <span class="nx">objAReference</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">base</span><span class="o">:</span> <span class="nx">obj</span> <span class="nb">Object</span><span class="p">,</span>
    <span class="nx">propertyName</span><span class="o">:</span> <span class="s1">&#39;A&#39;</span>
  <span class="p">};</span>

  <span class="c1">// reference Type</span>
  <span class="kd">var</span> <span class="nx">xReference</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">base</span><span class="o">:</span> <span class="nx">global</span> <span class="nx">object</span><span class="p">,</span>
    <span class="nx">propertyName</span><span class="o">:</span> <span class="s1">&#39;x&#39;</span>
  <span class="p">};</span>

  <span class="c1">// referenceType 값을 반환한다.</span>
  <span class="nx">GetValue</span><span class="p">(</span><span class="nx">xReference</span><span class="p">);</span> <span class="c1">// A function object</span>
</code></pre></div></li>
<li><p>레퍼런스 타입이 아닌 <strong>함수 표현식</strong>(즉시 실행 함수)</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global Execution Context</span>

  <span class="c1">// 식별자 또는 프로퍼티 접근자가 아닌 함수 표현식</span>
  <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 이 경우 레퍼런스 타입이 존재하지 않으므로, 결국 null 을 반환 후 자동으로 전역 객체로 변환된다.</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// null =&gt; global object</span>
  <span class="p">})();</span>
</code></pre></div></li>
<li><p>레퍼런스 타입 <strong>체크</strong></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// 식별자 또는 프로퍼티 접근자가 아닌 함수 표현식(즉시 실행 함수)은 reference Type 값이 존재하지 않는다.</span>
</code></pre></div></li>
<li><p><strong>함수 내부에 선언된 함수</strong></p>

<ul>
<li>A 함수 내부에 선언된 B 함수는 <span style="color:#c11f1f">AO</span>(VO) 가 갖는 <strong>속성</strong> 중 하나이다. 또한 <span style="color:#c11f1f">AO</span>(VO) 는 항상 <span style="color:#6298c1">this</span> 값을 <span style="color:#6298c1">null</span> 로 반환하기 때문에, 결국 B 함수 내부 <span style="color:#6298c1">this</span> 는 global object 를 갖게된다.(AO.B() === null.B())<p></li>
<li><p>The activation object always returns as this value — null (i.e. pseudo-code AO.bar() is equivalent to null.bar()). Here again we come back to the described above case, and again, this value is set to global object.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global execution context</span>

<span class="kd">function</span> <span class="nx">A</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">// function Execution Context</span>

  <span class="kd">function</span> <span class="nx">B</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// this === null =&gt; global object</span>
  <span class="p">}</span>

  <span class="nx">B</span><span class="p">();</span> <span class="c1">// AO.B() == null.B()</span>
<span class="p">}</span>

<span class="nx">A</span><span class="p">();</span>
</code></pre></div></li>
<li><p><span style="color:#c11f1f">ECStack</span> 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">&lt;</span><span class="nx">B</span><span class="o">&gt;</span> <span class="nx">activeFunctionExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">arguments</span><span class="o">:</span> <span class="p">{</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="k">this</span><span class="o">:</span> <span class="kc">null</span> <span class="o">==&gt;</span> <span class="nx">global</span> <span class="nb">Object</span>                          
    <span class="p">},</span>                      
    <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">arguments</span><span class="o">:</span> <span class="p">{</span>
        <span class="p">}</span>
        <span class="nx">B</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
      <span class="p">},</span>
      <span class="k">this</span><span class="o">:</span> <span class="nx">global</span> <span class="nb">Object</span>                          
    <span class="p">},</span>
    <span class="nx">globalExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
      <span class="p">},</span>
      <span class="k">this</span><span class="o">:</span> <span class="nx">global</span> <span class="nx">object</span>                        
    <span class="p">}</span>
  <span class="p">];</span>
</code></pre></div></li>
<li><p>레퍼런스 타입 <strong>체크</strong></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="c1">// reference Type</span>
    <span class="kd">var</span> <span class="nx">BReference</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">base</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nx">propertyName</span><span class="o">:</span> <span class="s1">&#39;B&#39;</span>
    <span class="p">};</span>

    <span class="c1">// referenceType 값을 반환한다.</span>
    <span class="nx">GetValue</span><span class="p">(</span><span class="nx">BReference</span><span class="p">);</span> <span class="c1">// B function object</span>
</code></pre></div></li>
</ul></li>
<li><p>생성자 함수 호출</p>

<ul>
<li><p>new 연산자의 <strong>객체 매커니즘</strong>에 따라 <span style="color:#6298c1">this</span> 값은 생성된 <strong>객체</strong>로 <strong>초기화</strong> 된다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global Execution Context</span>

  <span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

    <span class="c1">// function Execution Context</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;mohwa&#39;</span><span class="p">;</span>

    <span class="c1">// new 연산자 + 생성자 함수를 통해 생성된 객체로 초기화된다.</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// A object</span>
  <span class="p">}</span>

  <span class="c1">// 객체를 생성한다.</span>
  <span class="k">new</span> <span class="nx">A</span><span class="p">;</span>
</code></pre></div>
<p><img src="https://www.dropbox.com/s/4mkmvx22cmlo7ow/92.jpg?dl=1" alt=""></p></li>
<li><p>new 연산자 매커니즘 Pseudo-Code</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;mohwa&#39;</span><span class="p">;</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// A instance</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">New</span><span class="p">(</span><span class="nx">A</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span> <span class="c1">// A instance</span>

<span class="c1">// new 연산자 구현</span>
<span class="kd">function</span> <span class="nx">New</span><span class="p">(</span><span class="nx">constructor</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">constructor</span> <span class="o">=</span> <span class="nx">constructor</span> <span class="o">||</span> <span class="kd">function</span> <span class="nx">F</span><span class="p">(){};</span>

  <span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="c1">// 전달받은 생성자 함수 객체의 원형을 o 객체의 원형으로 위임한다.</span>
  <span class="nx">o</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">=</span> <span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>

  <span class="c1">// 생성자 함수 객체의 this 값을 o 객체로 초기화한다.</span>
  <span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><img src="https://www.dropbox.com/s/j4xkyq7ixpdvcbf/93.jpg?dl=1" alt=""></p></li>
</ul></li>
<li><p>함수 호출 시 <span style="color:#6298c1">this</span> 값을 <strong>초기화</strong> 하는 방법</p>

<ul>
<li>Function.prototype <strong>객체</strong> 메서드인 <span style="color:#6298c1">call</span> 과 <span style="color:#6298c1">apply</span> 메서드를 통해, 함수 호출 시 <span style="color:#6298c1">this</span> 값을 <strong>초기화</strong>할 수 있다.<p></li>
<li><p><span style="color:#6298c1">call</span> 메서드를 통해 전달된 <strong>객체</strong>로 <span style="color:#6298c1">this</span> 값을 <strong>초기화</strong>한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">A</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">){</span>

  <span class="c1">// function execution context</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// obj Object</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 1</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// 2</span>

<span class="p">}</span>

<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;mohwa&#39;</span>
<span class="p">};</span>

<span class="c1">// A 함수 객체의 this 값을 obj 객체로 초기화 한다.</span>
<span class="nx">A</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</code></pre></div></li>
<li><p><span style="color:#6298c1">apply</span> 메서드를 통해 전달된 <strong>객체</strong>로 <span style="color:#6298c1">this</span> 값을 <strong>초기화</strong>한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">A</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">){</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// obj Object</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 1</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// 2</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;mohwa&#39;</span>
<span class="p">};</span>

<span class="c1">// A 함수 객체의 this 값을 obj 객체로 초기화 한다.</span>
<span class="nx">A</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
</code></pre></div>
<h2 id="url">참고 URL</h2></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li><p><a href="http://dmitrysoshnikov.com/ecmascript/chapter-3-this/#function-call-and-non-reference-type">ECMA-262-3 IN DETAIL. CHAPTER 3. THIS</a></p></li>
<li><p><a href="http://huns.me/ecma-262-3-in-detail-chapter-3-this/">ECMA-262-3 IN DETAIL. CHAPTER 3. THIS(번역)</a></p></li>
<li><p><a href="http://www.nextree.co.kr/p7522/">this 키워드</a></p></li>
<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this">this</a></p></li>
<li><p><a href="http://mobicon.tistory.com/189">var _this this 의미 배우기</a></p></li>
</ul>

        </article>
        <p style="text-align: right"><a href="/blog/javascript/2015/10/14/this-inJS/">Read more</a></p>
        <hr style="margin-bottom:30px; border:0; border-bottom: 1px dotted #ccc;" />
    </li>
  
      <li>
          <header class="post-header">
            <h1 itemprop="name" class="post-title">
              <a itemprop="url" class="post-link" href="/blog/javascript/2015/10/13/execution-context-inJS/">Execution Context in JS</a>
            </h1>
            <div class="tags cf">
              
                <a href="/blog/search/?category=javascript">javascript</a>&nbsp;
              
              <time itemprop="datePublished" datetime="2015-10-13">
                Oct 13, 2015
              </time>
            </div>
        </header>

        <article style="position: relative; width: 100%; height: 400px; overflow-y: hidden; margin-bottom: 15px;">
          <p>이 글은 오래전 <a href="http://huns.me/">김훈민</a>님의 블로그 글을 통해 <strong>ECMA-262-3 in detail</strong> 번역본을 정독 후, 개인적인 테스트를 통해 다시한번 정리해본 내용입니다. </p>

<p><img src="https://www.dropbox.com/s/c9rg72fludmb0ak/84.png?dl=1" alt=""></p>

<ul>
<li><p><strong>Execution Context</strong> 는 일종의 <a href="http://ko.wikipedia.org/wiki/%EC%BD%9C_%EC%8A%A4%ED%83%9D">Call Stack</a> 형태를 취하고 있으며, Stack 의 <strong>바닥</strong>에는 Global <strong>Execution Context</strong> 가 존재하고, 가장 <strong>상위</strong>에는 <strong>현재 활성화된 Execution Context</strong> 가 놓이게된다.</p>

<ul>
<li><em>콜 스택(call stack) 이란 컴퓨터 과학에서 실행할 컴퓨터 프로그램 코드 정보를 저장하는 스택 자료구조이다. 또한 실행 스택(execution stack), 제어 스택 (control stack), 런 타임 스택 (run-time) 스택 혹은 기계 스택 (machine stack) 이라고도 하며 그냥 줄여서 스택 (the stack) 이라고도 한다. 소프트웨어 프로그램의 기능 수행에 있어 콜 스택의 유지 보수가 중요함에도 불구하고 구현 상세는 고급 프로그래밍 언어에서는 보통 감추어지며 자동화되어 있다.</em></li>
</ul></li>
<li><p><span style="color:#c11f1f">ECStack</span> 은 <strong>Execution Context</strong> 의 <a href="http://ko.wikipedia.org/wiki/%EC%BD%9C_%EC%8A%A4%ED%83%9D">Call Stack</a> 을 의미한다.</p></li>
<li><p><span style="color:#c11f1f">ECStack</span> 은 여러 종류의 <strong>Execution Context</strong> 들이 들어오고 나가면서(pushed or poped), 지속적으로 관리(변경)된다.</p>

<ul>
<li><span style="color:#c11f1f">ECStack</span> 은 <strong>LIFO</strong>(Last In First out) 자료구조를 가진다.</li>
</ul></li>
<li><p><a href="http://mohwa.github.io/blog/javascript/2015/10/09/prototype/">런타임 시점</a>에서 <strong>실행 코드</strong>를 만나게되면 해당되는 <strong>Execution Context</strong> 가 생성되고, 생성된 <strong>Execution Context</strong>  안에서 <strong>실행 코드</strong>가 처리된다.</p>

<ul>
<li><p><strong>Execution Context</strong> 예 1</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global Execution Context(buttom)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;global Execution Context&quot;</span><span class="p">);</span>

  <span class="kd">function</span> <span class="nx">Func1</span><span class="p">(){</span>
    <span class="c1">// active function Execution Context(top)</span>
  <span class="p">};</span>

  <span class="kd">function</span> <span class="nx">Func2</span><span class="p">(){</span>
    <span class="c1">// function Execution Context</span>
    <span class="nx">Func1</span><span class="p">();</span>
  <span class="p">};</span>

  <span class="nx">Func2</span><span class="p">();</span> <span class="c1">// call function object</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">&lt;</span><span class="nx">Func1</span><span class="o">&gt;</span> <span class="nx">active</span> <span class="kd">function</span> <span class="nx">Execution</span> <span class="nx">Context</span><span class="p">,</span>
    <span class="o">&lt;</span><span class="nx">Func2</span><span class="o">&gt;</span> <span class="kd">function</span> <span class="nx">Execution</span> <span class="nx">Context</span><span class="p">,</span>
    <span class="nx">global</span> <span class="nx">Execution</span> <span class="nx">Context</span>
  <span class="p">];</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// ECStack [생성 순서]</span>
  <span class="mi">1</span><span class="p">.</span> <span class="nx">global</span> <span class="nx">Execution</span> <span class="nx">Context</span>
  <span class="mi">2</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">Func2</span><span class="o">&gt;</span> <span class="nx">functional</span> <span class="nx">Execution</span> <span class="nx">Context</span>
  <span class="mi">3</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">Func1</span><span class="o">&gt;</span> <span class="nx">active</span> <span class="nx">functional</span> <span class="nx">Execution</span> <span class="nx">Context</span>

  <span class="c1">// ECStack [소멸 순서]</span>
  <span class="mi">1</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">Func1</span><span class="o">&gt;</span> <span class="nx">active</span> <span class="nx">functional</span> <span class="nx">Execution</span> <span class="nx">Context</span>
  <span class="mi">2</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">Func2</span><span class="o">&gt;</span> <span class="nx">functional</span> <span class="nx">Execution</span> <span class="nx">Context</span>
  <span class="mi">3</span><span class="p">.</span> <span class="nx">global</span> <span class="nx">Execution</span> <span class="nx">Context</span>
</code></pre></div></li>
<li><p><strong>Execution Context</strong> 예 2(재귀 호출)</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global Execution Context</span>
  <span class="kd">function</span> <span class="nx">A</span><span class="p">(</span><span class="nx">x</span><span class="p">){</span>

    <span class="c1">// function Execution Context</span>

    <span class="c1">// 전달된 함수 매개변수의 갯수</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// 1</span>
      <span class="c1">// call function object recursively</span>
      <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">A</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// call function object</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">active</span> <span class="kd">function</span> <span class="nx">Execution</span> <span class="nx">Context</span> <span class="o">-</span> <span class="nx">recursively</span><span class="p">,</span>
    <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="kd">function</span> <span class="nx">Execution</span> <span class="nx">Context</span><span class="p">,</span>
    <span class="nx">global</span> <span class="nx">Execution</span> <span class="nx">Context</span>
  <span class="p">];</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// ECStack [생성 순서]</span>
  <span class="mi">1</span><span class="p">.</span> <span class="nx">global</span> <span class="nx">Execution</span> <span class="nx">Context</span>
  <span class="mi">2</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">functional</span> <span class="nx">Execution</span> <span class="nx">Context</span>
  <span class="mi">3</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">active</span> <span class="kd">function</span> <span class="nx">Execution</span> <span class="nx">Context</span> <span class="o">-</span> <span class="nx">recursively</span>

  <span class="c1">// ECStack [소멸 순서]</span>
  <span class="mi">1</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">active</span> <span class="kd">function</span> <span class="nx">Execution</span> <span class="nx">Context</span> <span class="o">-</span> <span class="nx">recursively</span>
  <span class="mi">2</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">functional</span> <span class="nx">Execution</span> <span class="nx">Context</span>
  <span class="mi">3</span><span class="p">.</span> <span class="nx">global</span> <span class="nx">Execution</span> <span class="nx">Context</span>
</code></pre></div></li>
<li><p><strong>Execution Context</strong> 예 3(생성자 함수 호출)</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global Execution Context</span>
<span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

  <span class="c1">// A function Execution Context</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="k">new</span> <span class="nx">A</span><span class="p">);</span> <span class="c1">// create instance</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">active</span> <span class="kd">function</span> <span class="nx">Execution</span> <span class="nx">Context</span><span class="p">,</span>
    <span class="nx">global</span> <span class="nx">Execution</span> <span class="nx">Context</span>
  <span class="p">];</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// ECStack [생성 순서]</span>
  <span class="mi">1</span><span class="p">.</span> <span class="nx">global</span> <span class="nx">Execution</span> <span class="nx">Context</span>
  <span class="mi">2</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">active</span> <span class="kd">function</span> <span class="nx">Execution</span> <span class="nx">Context</span>

  <span class="c1">// ECStack [소멸 순서]</span>
  <span class="mi">1</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">active</span> <span class="kd">function</span> <span class="nx">Execution</span> <span class="nx">Context</span>
  <span class="mi">2</span><span class="p">.</span> <span class="nx">global</span> <span class="nx">Execution</span> <span class="nx">Context</span>
</code></pre></div></li>
</ul></li>
</ul>

<h2 id="url">참고 URL</h2>

<ul>
<li><p><a href="http://dmitrysoshnikov.com/ecmascript/chapter-1-execution-contexts/">ECMA-262-3 IN DETAIL. CHAPTER 1. EXECUTION CONTEXTS</a></p></li>
<li><p><a href="http://huns.me/development/159">ECMA-262-3 IN DETAIL. CHAPTER 1. EXECUTION CONTEXT 번역 글</a></p></li>
<li><p><a href="http://davidshariff.com/blog/what-is-the-execution-context-in-javascript/">What is the Execution Context &amp; Stack in JavaScript?</a></p></li>
<li><p><a href="http://www.yusufaytas.com/javascript-execution-context/">JavaScript Execution Context</a></p></li>
</ul>

        </article>
        <p style="text-align: right"><a href="/blog/javascript/2015/10/13/execution-context-inJS/">Read more</a></p>
        <hr style="margin-bottom:30px; border:0; border-bottom: 1px dotted #ccc;" />
    </li>
  
      <li>
          <header class="post-header">
            <h1 itemprop="name" class="post-title">
              <a itemprop="url" class="post-link" href="/blog/javascript/2015/10/11/scope-chain-inJS/">Scope Chain 그리고 Closure</a>
            </h1>
            <div class="tags cf">
              
                <a href="/blog/search/?category=javascript">javascript</a>&nbsp;
              
              <time itemprop="datePublished" datetime="2015-10-11">
                Oct 11, 2015
              </time>
            </div>
        </header>

        <article style="position: relative; width: 100%; height: 400px; overflow-y: hidden; margin-bottom: 15px;">
          <ul>
<li><p>Execution Context 와 <span style="color:#c11f1f">ECStack</span> 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="c1">// global execution context</span>

    <span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

      <span class="c1">// A 함수 선언식 내부</span>
      <span class="c1">// function execution context</span>
      <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// AO.x</span>

      <span class="kd">function</span> <span class="nx">B</span><span class="p">(){</span>

        <span class="c1">// B 함수 선언식 내부</span>
        <span class="c1">// active function execution context</span>
        <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// AO.y</span>
      <span class="p">}</span>

      <span class="nx">B</span><span class="p">();</span> <span class="c1">// AO.B() == null.B()</span>
    <span class="p">}</span>

    <span class="nx">A</span><span class="p">();</span> <span class="c1">// this.A();</span>
</code></pre></div></li>
<li><p><span style="color:#c11f1f">ECStack</span> 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">// B function execution context</span>
    <span class="o">&lt;</span><span class="nx">B</span><span class="o">&gt;</span> <span class="nx">activeFunctionExecutionContext</span><span class="o">:</span> <span class="p">{</span> 
      <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span>
      <span class="p">},</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">},</span>     
        <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="p">.</span><span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="nx">B</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
        <span class="p">},</span>                         
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="c1">// A function execution context</span>
    <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">B</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
      <span class="p">},</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="nx">B</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
        <span class="p">},</span>
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
        <span class="p">}</span>
      <span class="p">]</span>          
    <span class="p">},</span>
    <span class="c1">// global execution context</span>
    <span class="nx">globalExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
      <span class="p">},</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">];</span>
</code></pre></div></li>
<li><p>Global Execution Context 의 <strong>Scope Chain</strong></p>

<ul>
<li><p>Global Execution Context 내부에 생성되는 <strong>Scope Chain</strong> 은 globalExecutionContext.VO 만 <strong>포함</strong>한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">globalExecutionContext</span><span class="o">:</span><span class="p">{</span>
      <span class="nx">VO</span><span class="o">:</span> <span class="p">...</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span>
      <span class="p">]</span>
    <span class="p">}</span>
</code></pre></div></li>
</ul></li>
<li><p><strong>함수 생명 주기</strong> 와 Function Execution Context 의 <strong>Scope Chain</strong></p>

<ul>
<li>함수 생명 주기는 <strong>함수 생성</strong>과 <strong>함수 호출</strong>로 나눌 수 있다.</li>
<li><p>함수 생성</p>

<ul>
<li><strong>함수 생성 시</strong> [[Scope]] property 가 <strong>생성</strong>된다.<p></li>
<li>[[Scope]] property 는 직접적인 접근이 불가능하며, <strong>초기화</strong>된 값은 변경되지 않는다.<p></li>
<li>[[Scope]] property 는 해당 Function Execution Context 상위에 있는 <u>모든 부모 계층의 <span style="color:#c11f1f">VO</span> 를 갖는다.</u><p></li>
<li><p>A 함수를 선언한다</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global execution context</span>

  <span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

  <span class="p">}</span>
</code></pre></div></li>
<li><p><span style="color:#c11f1f">함수 생성</span> 시 함수 객체 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="nx">A</span><span class="o">:</span> <span class="p">{</span>
    <span class="p">[[</span><span class="nx">Scope</span><span class="p">]]</span><span class="o">:</span> <span class="p">[</span>
      <span class="c1">// A 함수는 [[Scope]] property 를 통해 global execution context 의 VO 를 갖는다.</span>
      <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span>
    <span class="p">];</span>
  <span class="p">}</span>
</code></pre></div></li>
<li><p>함수 내부에 또 다른 함수 생성</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global execution context</span>

  <span class="c1">// 변수 선언 VO.x</span>
  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> 

  <span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

    <span class="c1">// function execution context</span>
    <span class="c1">// 변수 선언 AO.y</span>
    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">B</span><span class="p">(){</span>

      <span class="c1">// function execution context</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">A</span><span class="p">();</span>
</code></pre></div></li>
<li><p>각 함수 객체 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">A</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">[[</span><span class="nx">Scope</span><span class="p">]]</span><span class="o">:</span> <span class="p">[</span>
        <span class="c1">// A 함수는 global execution context 의 VO 를 갖는다.</span>
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span>
      <span class="p">];</span>
    <span class="p">}</span>

    <span class="nx">B</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">[[</span><span class="nx">Scope</span><span class="p">]]</span><span class="o">:</span> <span class="p">[</span>
        <span class="c1">// B 함수는 global execution context 의 VO 와 부모 함수인 A 함수의 AO(VO)를 갖는다.                    </span>
        <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="p">.</span><span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">),</span>
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span>
      <span class="p">];</span>
    <span class="p">}</span>
</code></pre></div></li>
</ul></li>
<li><p>함수 호출</p>

<ul>
<li>함수 호출 시, Function Execution Context 내부에 <strong>Scope Chain</strong> 이 추가된다.<p></li>
<li><p><strong>Scope Chain</strong> 은 함수 [[Scope]] property 를 그대로 가져가 <strong>초기화</strong>되며, Function Execution Context 내부 <span style="color:#c11f1f">AO</span>(VO)는 <strong>Scope Chain</strong> 의 <u><strong>가장 앞</strong>에 추가된다.</u></p>

<p><img src="http://figures.oreilly.com/tagoreillycom20090601oreillybooks300541I_book_d1e1/figs/I_mediaobject7_d1e6895-web.png" alt="">      </p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global execution context</span>

  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

    <span class="c1">// function execution context</span>

    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">A</span><span class="p">();</span> <span class="c1">// call A function object</span>
</code></pre></div></li>
<li><p><span style="color:#c11f1f">ECStack</span> 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">// A function execution context</span>
    <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span>
      <span class="p">},</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="c1">// 함수 호출 시, 생성된 AO 는 Scope Chain 의 가장 앞(ScopeChain[0])에 추가되며, 식별자 검색 시 가장 먼저 검색된다.</span>
        <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">},</span>                  
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">globalExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>                                
      <span class="p">},</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span>
      <span class="p">]</span>                  
    <span class="p">}</span>
  <span class="p">];</span>
</code></pre></div></li>
</ul></li>
<li><p>식별자 해석 과정</p>

<ul>
<li><strong>식별자</strong> 검색 순서는 <u><strong>Scope Chain</strong> 의 가장 <strong>바닥</strong>(ScopeChain[0])에서부터</u>, <u>가장 <strong>상위</strong>(ScopeChain[scope.length]) 까지</u> 검색 후, 그 값을 반환한다.</li>
<li><p>즉, 이와같은 <strong>검색 매커니즘</strong>에 의해, 해당 <strong>함수</strong>가 가진 <span style="color:#c11f1f">AO</span>(VO) 의 속성을 가장 빠르게 <strong>접근</strong>할 수 있으며, Global Execution Context 내부 <span style="color:#c11f1f">VO</span> 의 속성에 <strong>접근</strong>하는것이 가장 느린것이다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global execution context</span>

  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

    <span class="c1">// function execution context</span>

    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="c1">// functionExecutionContext.scopeChain.globalExecutionContext.VO.x                </span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 1</span>
    <span class="c1">// functionExecutionContext.scopeChain.AO.y</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// 2</span>
  <span class="p">}</span>

  <span class="nx">A</span><span class="p">();</span>
</code></pre></div></li>
<li><p><span style="color:#c11f1f">ECStack</span> 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span>
      <span class="p">},</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">},</span>                  
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">globalExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>                                
      <span class="p">},</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span>
      <span class="p">]</span>                  
    <span class="p">}</span>
  <span class="p">];</span>
</code></pre></div></li>
<li><p>만약, 각 Execution Context 에 선언된 <strong>식별자 이름</strong>이 같은 경우, 위에서 언급한 <strong>Scope Chain</strong> 의 <strong>검색 순서</strong>로 해당 값이 정해지게 된다.</p></li>
<li><p>BFunctionExecutionContext.AO.y</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global execution context</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

  <span class="c1">// function execution context</span>

  <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">B</span><span class="p">(){</span>

    <span class="c1">// active function execution context</span>

    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="c1">// BFunctionExecutionContext.AO.y</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// 3</span>
  <span class="p">}</span>

  <span class="nx">B</span><span class="p">();</span> <span class="c1">// AO.B() === null.B();</span>
<span class="p">}</span>

<span class="nx">A</span><span class="p">();</span>
</code></pre></div></li>
<li><p>AFunctionExecutionContext.AO.y</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global execution context</span>

  <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

    <span class="c1">// function execution context</span>

    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">B</span><span class="p">(){</span>

      <span class="c1">// active function execution context</span>

      <span class="c1">// B 함수에 선언된 y 변수를 삭제한다.</span>
      <span class="c1">// var y = 3;</span>
      <span class="c1">// AFunctionExecutionContext.AO.y</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// 2</span>
    <span class="p">}</span>

    <span class="nx">B</span><span class="p">();</span> <span class="c1">// AO.B() === null.B();</span>
  <span class="p">}</span>

  <span class="nx">A</span><span class="p">();</span>
</code></pre></div></li>
<li><p>globalExecutionContext.VO.y</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global execution context</span>
  <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

    <span class="c1">// function execution context</span>

    <span class="c1">// A 함수에 선언된 y 변수를 삭제한다.</span>
    <span class="c1">// var y = 2;</span>

    <span class="kd">function</span> <span class="nx">B</span><span class="p">(){</span>

      <span class="c1">// active function execution context</span>
      <span class="c1">// B 함수에 선언된 y 변수를 삭제한다.</span>
      <span class="c1">// var y = 3;</span>

      <span class="c1">// globalExecutionContext.VO.y</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// 1</span>
    <span class="p">}</span>

    <span class="nx">B</span><span class="p">();</span> <span class="c1">// AO.B() === null.B();</span>
  <span class="p">}</span>

  <span class="nx">A</span><span class="p">();</span>
</code></pre></div></li>
<li><p><span style="color:#c11f1f">ECStack</span> 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>

  <span class="o">&lt;</span><span class="nx">B</span><span class="o">&gt;</span> <span class="nx">activeFunctionExecutionContext</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">y</span><span class="o">:</span> <span class="mi">3</span>
    <span class="p">},</span>
    <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
      <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">y</span><span class="o">:</span> <span class="mi">3</span>
      <span class="p">},</span>                
      <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="p">.</span><span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="nx">B</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
      <span class="p">},</span>                
      <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">y</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="nx">B</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
    <span class="p">},</span>
    <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
      <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="nx">B</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
      <span class="p">},</span>                
      <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">y</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="nx">globalExecutionContext</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">y</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
    <span class="p">},</span>
    <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
      <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span>
    <span class="p">]</span>                
  <span class="p">}</span>
<span class="p">];</span>
</code></pre></div></li>
<li><p>또 다른 Scope Chain 예</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global execution context</span>

<span class="kd">var</span> <span class="nx">num2</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">add</span><span class="p">(</span><span class="nx">num1</span><span class="p">,</span> <span class="nx">num2</span><span class="p">){</span>

  <span class="c1">// function execution context</span>

  <span class="c1">// result 변수는 undefined 로 초기화된다.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span> <span class="c1">// undefined</span>

  <span class="c1">// functionExecution.AO.num1</span>
  <span class="c1">// functionExecution.AO.num2</span>
  <span class="k">return</span> <span class="nx">num1</span> <span class="o">+</span> <span class="nx">num2</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">add</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="c1">// 실행 코드 처리 후 result 변수에 15 가 할당된다.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span> <span class="c1">// 15</span>
</code></pre></div></li>
<li><p><span style="color:#c11f1f">ECStack</span> 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">&lt;</span><span class="nx">add</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">arguments</span><span class="o">:</span> <span class="p">{</span>
          <span class="mi">0</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
          <span class="mi">1</span><span class="o">:</span> <span class="mi">10</span>
        <span class="p">},</span>
        <span class="nx">num1</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="nx">num2</span><span class="o">:</span> <span class="mi">10</span>
      <span class="p">},</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">arguments</span><span class="o">:</span> <span class="p">{</span>
            <span class="mi">0</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="mi">1</span><span class="o">:</span> <span class="mi">10</span>
          <span class="p">},</span>
          <span class="nx">num1</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
          <span class="nx">num2</span><span class="o">:</span> <span class="mi">10</span>
        <span class="p">},</span>                  
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">result</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
          <span class="nx">add</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span><span class="p">,</span>
          <span class="nx">num2</span><span class="o">:</span> <span class="mi">5</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">globalExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">result</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>                  
        <span class="nx">add</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span><span class="p">,</span>
        <span class="nx">num2</span><span class="o">:</span> <span class="mi">5</span>
      <span class="p">},</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span>
      <span class="p">]</span>                  
    <span class="p">}</span>
  <span class="p">];</span>
</code></pre></div></li>
</ul></li>
</ul></li>
<li><p>JS 에서 말하는 <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Guide/Closures">Closure</a>란? 별도의 <strong>개념</strong>이 아닌, <u><strong>Scope Chain 매커니즘</strong></u>에 의한 <strong>바인딩 환경</strong>을 말하는것이다.<p></p>

<ul>
<li><p>일반적인 Closure 환경</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global execution context</span>

  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

      <span class="c1">// function execution context;</span>

      <span class="c1">// 식별자 검색을 통해, 상위 계층의 VO 에 접근하여 결과를 반환한다.</span>
      <span class="c1">// AFunctionExecutionContext.scopeChain[1].VO.x</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 1</span>
  <span class="p">}</span>

  <span class="nx">A</span><span class="p">();</span>
</code></pre></div></li>
<li><p>하지만 Closure <strong>환경</strong>으로 인해, <strong>메모리 누수</strong>가 발생할 수 있다.</p>

<ul>
<li>makeAdder 함수 호출 시, 반환받은 add5 함수 [[Scope]] 속성에는, 모든 부모 계층의 <span style="color:#c11f1f">VO, AO(VO)</span> 가 <strong>영구적</strong>으로 포함된다.</li>
<li><p>즉 makeAdder 함수(상위 계층) 종료 시, 소멸되는 <span style="color:#c11f1f">AO(VO)</span> 가, 해당 [[Scope]] 속성 내부에 영구적으로 보관된다는 것이다.(<strong>메모리 누수의 원인</strong>)</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global execution context</span>

  <span class="kd">function</span> <span class="nx">makeAdder</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// function execution context</span>

    <span class="c1">// 반환되는 익명함수에는 Scope Chain 매커니즘에 의해 부모 계층의 모든 VO 가 포함되어있다.</span>
    <span class="c1">// 부모 계층의 AO(VO)({x: 5})</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// function execution context</span>
      <span class="c1">// Scope Chain 의 식별자 검색을 통해 부모 계층의 Vo.x 속성을 사용한다.</span>

      <span class="c1">// anonymousFunctionExecutionContext.scopeChain.makeAdderFunctionExecutionContext.AO.x</span>
      <span class="c1">// anonymousFunctionExecutionContext.scopeChain.AO.y</span>
      <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">add5</span> <span class="o">=</span> <span class="nx">makeAdder</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

  <span class="nx">print</span><span class="p">(</span><span class="nx">add5</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>  <span class="c1">// 7</span>
</code></pre></div></li>
<li><p>anonymousFunction(= add5) 함수 [[Scope]] 속성 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"> <span class="nx">anonymousFunction</span><span class="p">(</span><span class="o">=</span> <span class="nx">add5</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
  <span class="p">[[</span><span class="nx">Scope</span><span class="p">]]</span><span class="o">:</span> <span class="p">[</span>
    <span class="o">&lt;</span><span class="nx">makeAdder</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="p">.</span><span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">arguments</span><span class="o">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="o">:</span> <span class="mi">5</span>                
      <span class="p">},</span>
      <span class="nx">x</span><span class="o">:</span> <span class="mi">5</span>
    <span class="p">},</span>
    <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">makeAdder</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span><span class="p">,</span>
      <span class="nx">add5</span><span class="o">:</span> <span class="kc">undefined</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></li>
<li><p>anonymousFunction(= add5) 함수 <strong>Scope Chain</strong> 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"> <span class="nx">anonymousFunction</span><span class="p">(</span><span class="o">=</span> <span class="nx">add5</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">AO</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">arguments</span><span class="o">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="o">:</span> <span class="mi">2</span>                
      <span class="p">},</span>
      <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span>                
    <span class="p">},</span>
    <span class="o">&lt;</span><span class="nx">makeAdder</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="p">.</span><span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">arguments</span><span class="o">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="o">:</span> <span class="mi">5</span>                
      <span class="p">},</span>
      <span class="nx">x</span><span class="o">:</span> <span class="mi">5</span>
    <span class="p">},</span>
    <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">makeAdder</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span><span class="p">,</span>
      <span class="nx">add5</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></li>
</ul></li>
</ul></li>
<li><p>Eval Execution Context 의 <strong>Scope Chain</strong></p>

<ul>
<li>eval execution context 의 <strong>Scope Chain</strong> 은 calling context 의 <strong>Scope Chain</strong> 을 따라간다.</li>
<li><p>즉 <span style="color:#6298c1">eval</span> 함수가 포함된 execution context 의 <strong>Scope Chain</strong> 을 갖는다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="nx">evalExecutionContext</span><span class="p">.</span><span class="nx">Scope</span> <span class="o">===</span> <span class="nx">callingContext</span><span class="p">.</span><span class="nx">Scope</span><span class="p">;</span>
</code></pre></div></li>
<li><p>실행 코드 </p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global execution context</span>
  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// global execution context 의 Scope Chain 을 갖는다.</span>
  <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;console.log(x)&#39;</span><span class="p">);</span> <span class="c1">// 1</span>

  <span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

    <span class="c1">// function execution context</span>

    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="c1">// A function execution context 의 Scope Chain 을 갖는다.</span>
    <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;console.log(x, y)&#39;</span><span class="p">);</span> <span class="c1">// 1 2</span>

    <span class="kd">function</span> <span class="nx">B</span><span class="p">(){</span>

      <span class="c1">// B function execution context 의 Scope Chain 을 갖는다.</span>

      <span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

      <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;console.log(x, y, z)&#39;</span><span class="p">);</span> <span class="c1">// 1 2 3</span>
    <span class="p">}</span>

    <span class="nx">B</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">A</span><span class="p">();</span>      
</code></pre></div></li>
</ul></li>
<li><p>Function 생성자 함수</p>

<ul>
<li><p><span style="color:#c11f1f">Function 생성자 함수</span>를 통한, <strong>함수 생성 시</strong> 생성되는 [[Scope]] property 에는 Global Execution Context 의 <span style="color:#c11f1f">VO</span> 만 포함된다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global execution context</span>
<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nb">Function</span><span class="p">(</span><span class="s1">&#39;console.log(x, y);&#39;</span><span class="p">);</span> <span class="c1">// 1, 2</span>

<span class="nx">fn</span><span class="p">();</span>
</code></pre></div></li>
<li><p>globalExecutionContext 의 x 변수에 접근</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global execution context</span>
<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

  <span class="c1">// function execution context</span>

  <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nb">Function</span><span class="p">(</span><span class="s1">&#39;console.log(x);&#39;</span><span class="p">);</span> <span class="c1">// 1</span>

  <span class="nx">fn</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">A</span><span class="p">();</span>
</code></pre></div></li>
<li><p>functionExecutionContext 의 y 변수에 접근</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global execution context</span>

<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

  <span class="c1">// function execution context</span>

  <span class="c1">// AFunctionExecutionContext.AO.y</span>
  <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nb">Function</span><span class="p">(</span><span class="s1">&#39;console.log(y);&#39;</span><span class="p">);</span> <span class="c1">// Uncaught ReferenceError: y is not defined</span>

  <span class="nx">fn</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">A</span><span class="p">();</span>
</code></pre></div></li>
</ul></li>
<li><p>Prototype Chain 확장 검색</p>

<ul>
<li>만약 <strong>Scope Chain</strong> 내부 <span style="color:#c11f1f">VO</span> 에 원하는 <strong>식별자 이름</strong>이 없을경우, <span style="color:#c11f1f">VO</span> 객체의 <strong>원형</strong>인 Object.prototype 까지 검색 후 찾아낸다.</li>
<li><p>즉 <em>Global Execution Context 내부 <span style="color:#c11f1f">VO</span> 는 그 원형인 Object.prototype 객체를 참조할 수 있다.</em></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global execution context</span>

<span class="kd">function</span> <span class="nx">A</span><span class="p">(){</span>

    <span class="c1">// 어떤 execution context 의 VO 에도 x 속성이 선언하지 않았다.</span>

    <span class="c1">// function execution context</span>
    <span class="c1">// globalExecutionContext.VO.__proto__.x 속성을 참조한다.</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 1</span>
<span class="p">}</span>

<span class="c1">// Object 객체의 원형을 확장한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="nx">A</span><span class="p">();</span>
</code></pre></div></li>
<li><p><span style="color:#c11f1f">ECStack</span> 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">functionExecutionContext</span><span class="o">:</span> <span class="p">{</span> <span class="c1">// A function object</span>
      <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">},</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
        <span class="p">},</span>              
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span><span class="p">,</span>
          <span class="nx">__proto__</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">globalExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">A</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span><span class="p">,</span>
        <span class="nx">__proto__</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span>
      <span class="p">]</span>              
    <span class="p">}</span>
  <span class="p">];</span>
</code></pre></div></li>
</ul></li>
<li><p><strong>Scope Chain</strong> 을 <strong>확장</strong>하는 with 문 과 catch 절</p>

<ul>
<li><p>with 문</p>

<ul>
<li>with 문을 만나면, 해당 Execution Context 의 <strong>Scope Chain</strong> 은 전달된 인자로 <strong>확장</strong>된다.<p></li>
<li><p><span style="color:#c11f1f">실행 코드</span></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global execution context</span>

<span class="c1">// globalExecutionContext.VO.person</span>
<span class="kd">var</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Nicholas&#39;</span><span class="p">,</span>
    <span class="nx">age</span><span class="o">:</span> <span class="mi">30</span>
<span class="p">};</span>

<span class="c1">// globalExecutionContext.VO.num2</span>
<span class="kd">var</span> <span class="nx">num2</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="c1">// globalExecutionContext.VO.displayInfo</span>
<span class="kd">function</span> <span class="nx">displayInfo</span><span class="p">(){</span>

    <span class="c1">// function execution context</span>
    <span class="c1">// displayInfoFunctionExecutionContext.AO.count</span>
    <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

    <span class="c1">// with 문에 전달된 인자(person)로 해당 Scope Chain 이 확장된다.</span>
    <span class="kd">with</span> <span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Angel&#39;</span><span class="p">,</span> <span class="nx">age</span><span class="o">:</span> <span class="mi">18</span><span class="p">}){</span>

        <span class="c1">// 확장된 Scope Chain 을 통해 객체 속성에 접근한다.</span>
        <span class="c1">// displayInfoFunctionExecutionContext.scopeChain.withObject.name</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span> <span class="c1">// &#39;Angel&#39;</span>
        <span class="c1">// displayInfoFunctionExecutionContext.scopeChain.withObject.age</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">age</span><span class="p">);</span> <span class="c1">// 18</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">displayInfo</span><span class="p">();</span>
</code></pre></div></li>
<li><p><span style="color:#c11f1f">ECStack</span> 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">&lt;</span><span class="nx">displayInfo</span><span class="o">&gt;</span> <span class="nx">functionExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">arguments</span><span class="o">:</span> <span class="p">{</span>
        <span class="p">},</span>
        <span class="nx">count</span><span class="o">:</span> <span class="mi">5</span>
      <span class="p">},</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="c1">// with 문으로 인해, Scope Chain 이 확장된다.(Scope Chain 의 가장 앞(ScopeChain[0])에 추가된다.</span>
        <span class="kd">with</span><span class="p">(</span><span class="nx">VO</span><span class="p">(</span><span class="nx">person</span><span class="p">))</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Angel&#39;</span><span class="p">,</span>
          <span class="nx">age</span><span class="o">:</span> <span class="mi">18</span>
        <span class="p">},</span>    
        <span class="nx">AO</span><span class="p">(</span><span class="nx">VO</span><span class="p">)</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">arguments</span><span class="o">:</span> <span class="p">{</span>
          <span class="p">},</span>
          <span class="nx">count</span><span class="o">:</span> <span class="mi">5</span>
        <span class="p">},</span>                                  
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">person</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Nicholas&#39;</span><span class="p">,</span>
            <span class="nx">age</span><span class="o">:</span> <span class="mi">30</span>
          <span class="p">},</span>
          <span class="nx">displayInfo</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span><span class="p">,</span>
          <span class="nx">num2</span><span class="o">:</span> <span class="mi">10</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">globalExecutionContext</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">person</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Nicholas&#39;</span><span class="p">,</span>
          <span class="nx">age</span><span class="o">:</span> <span class="mi">30</span>
        <span class="p">},</span>
        <span class="nx">displayInfo</span><span class="o">:</span> <span class="o">&lt;</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="kd">function</span> <span class="o">&gt;</span><span class="p">,</span>
        <span class="nx">num2</span><span class="o">:</span> <span class="mi">10</span>
      <span class="p">},</span>
      <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span>
      <span class="p">]</span>                  
    <span class="p">}</span>
  <span class="p">];</span>
</code></pre></div></li>
</ul></li>
<li><p>catch 절</p>

<ul>
<li><p>catch 절을 만나면, 해당 Execution Context 의 <strong>Scope Chain</strong> 은 전달된 인자(ex)로 <strong>확장</strong>된다.<p></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// global execution context</span>

  <span class="k">try</span><span class="p">{</span>

    <span class="nx">a</span><span class="p">;</span> <span class="c1">// error</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="nx">ex</span><span class="p">){</span>

    <span class="c1">// globalExecutionContext.scopeChain.catchObject(ex).message</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ex</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></li>
<li><p><span style="color:#c11f1f">ECStack</span> 내부</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="kd">var</span> <span class="nx">ECStack</span> <span class="o">=</span> <span class="p">[</span>
      <span class="nx">globalExecutionContext</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
        <span class="p">},</span>
        <span class="nx">Scope</span><span class="p">(</span><span class="nx">Scope</span> <span class="nx">Chain</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span>
          <span class="k">catch</span><span class="p">(</span><span class="nx">VO</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">exception</span> <span class="nx">object</span><span class="o">&gt;</span><span class="p">))</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;a is not defined&#39;</span><span class="p">,</span>
            <span class="p">...</span>
          <span class="p">},</span>                    
          <span class="nx">globalExecutionContext</span><span class="p">.</span><span class="nx">VO</span><span class="o">:</span> <span class="p">{</span>
          <span class="p">}</span>
        <span class="p">]</span>                   
      <span class="p">}</span>
    <span class="p">];</span>
</code></pre></div></li>
</ul></li>
</ul></li>
</ul>

<h2 id="url">참고 URL</h2>

<ul>
<li><p><a href="http://dmitrysoshnikov.com/ecmascript/chapter-4-scope-chain/">ECMA-262-3 in detail. Chapter 4. Scope chain.</a><p></p></li>
<li><p><a href="http://archive.oreilly.com/pub/a/server-administration/excerpts/even-faster-websites/writing-efficient-javascript.html">Writing Efficient JavaScript: Chapter 7 - Even Faster Websites</a></p></li>
</ul>

        </article>
        <p style="text-align: right"><a href="/blog/javascript/2015/10/11/scope-chain-inJS/">Read more</a></p>
        <hr style="margin-bottom:30px; border:0; border-bottom: 1px dotted #ccc;" />
    </li>
  
      <li>
          <header class="post-header">
            <h1 itemprop="name" class="post-title">
              <a itemprop="url" class="post-link" href="/blog/javascript/2015/10/09/enumerable-inJS/">JS Enumerable(열거자) or Nonenumerable(비 열거자)</a>
            </h1>
            <div class="tags cf">
              
                <a href="/blog/search/?category=javascript">javascript</a>&nbsp;
              
              <time itemprop="datePublished" datetime="2015-10-09">
                Oct 9, 2015
              </time>
            </div>
        </header>

        <article style="position: relative; width: 100%; height: 400px; overflow-y: hidden; margin-bottom: 15px;">
          <h2 id="1">1. 정의</h2>

<ul>
<li><p>JS 객체 속성은 <strong>Enumerable</strong>(열거자) 또는 <strong>Nonenumerable</strong>(비열거자) 로 정의할 수 있으며, 이들을 <strong>탐색</strong>, <strong>검색</strong>, <strong>반복</strong> 할 수 있는 <strong>built-in</strong> 수단(문 or 메서드)들을 제공하고있다.</p>

<ul>
<li><p>위에서 언급한바와같이, <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">Object.defineProperty</a> 메서드를 통해, 객체 속성을 <strong>Enumerable</strong> 또는 <strong>Nonenumerable</strong> 로 정의할 수 있다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>

<span class="c1">// 객체의 x 속성을 enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">1</span>
<span class="p">});</span>

<span class="c1">// 객체의 y 속성을 non-enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">2</span>
<span class="p">});</span>

<span class="c1">// propertyIsEnumerable 메서드를 통해, 전달된 객체 속성의 enumerable 유/무를 반환한다.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">propertyIsEnumerable</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">));</span> <span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">propertyIsEnumerable</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">));</span> <span class="c1">// false</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span> <span class="c1">// Object {x: 1, y: 2}</span>
</code></pre></div></li>
</ul></li>
<li><p><strong>built-in 수단</strong></p>

<ul>
<li><p><strong>탐색</strong>(Detection)</p>

<ul>
<li><p><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Object/propertyIsEnumerable">Object.prototype.propertyIsEnumerable</a></p>

<ul>
<li><p>전달된 <strong>속성 이름</strong>(<span style="color:#c11f1f">상속받은 속성이 제외된 속성 중</span>)의 <strong>Enumerable</strong> 유/무를 반환한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>

<span class="c1">// 객체의 x 속성을 enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">1</span>
<span class="p">});</span>

<span class="c1">// 객체의 y 속성을 non-enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">2</span>
<span class="p">});</span>

<span class="c1">// 객체 원형을 확장시킨다.</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="c1">// enumerable</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">propertyIsEnumerable</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">));</span> <span class="c1">// true</span>
<span class="c1">// non-enumerable</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">propertyIsEnumerable</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">));</span> <span class="c1">// false</span>

<span class="c1">// 객체 원형(obj.constructor.prototype)을 확장하여, 상속된 z 속성에 대해서는 false 를 반환하게된다.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">propertyIsEnumerable</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">));</span> <span class="c1">// false</span>
</code></pre></div></li>
<li><p><a href="https://msdn.microsoft.com/ko-kr/library/adebfyya(v=vs.94).aspx">https://msdn.microsoft.com/ko-kr/library/adebfyya(v=vs.94).aspx</a></p></li>
</ul></li>
<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty">Object.prototype.hasOwnProperty</a></p>

<ul>
<li>전달된 <strong>속성 이름</strong>(<span style="color:#c11f1f">상속받은 속성이 제외된 속성 중</span>)의 <strong>정의</strong> 유/무를 반환한다.</li>
<li><p>단 <span style="color:#6298c1">propertyIsEnumerable</span> 메서드와 달리, <strong>Nonenumerable</strong> 유/무를 판단하지 못한다.(즉 무조건 <span style="color:#c11f1f">true</span> 를 반환하게된다)</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>

<span class="c1">// 객체의 x 속성을 enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">1</span>
<span class="p">});</span>

<span class="c1">// 객체의 y 속성을 non-enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">2</span>
<span class="p">});</span>

<span class="c1">// 객체 원형을 확장시킨다.</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="c1">// enumerable</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">));</span> <span class="c1">// true</span>
<span class="c1">// non-enumerable</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">));</span> <span class="c1">// true</span>

<span class="c1">// 객체 원형(obj.constructor.prototype)을 확장하여, 상속받은 z 속성에 대해서는 false 를 반환하게된다.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">));</span> <span class="c1">// false</span>
</code></pre></div></li>
</ul></li>
</ul></li>
<li><p><strong>검색</strong>(Retrieval)</p>

<ul>
<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys">Object.keys</a></p>

<ul>
<li><p>전달된 <strong>객체</strong> <strong>속성</strong> 중(<span style="color:#c11f1f">상속받은 속성이 제외된 속성 중</span>) <strong>Enumerable</strong> 속성으로만 이루어진 <strong>배열</strong>을 반환한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>

<span class="c1">// 객체의 x 속성을 enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">1</span>
<span class="p">});</span>

<span class="c1">// 객체의 y 속성을 non-enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">2</span>
<span class="p">});</span>

<span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="c1">// enumerable 속성으로만 이루어진 배열을 반환한다.</span>
<span class="c1">// 이전과 마찬가지로 상속받은 z 속성은 제외된다.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">));</span> <span class="c1">// [&quot;x&quot;]</span>
</code></pre></div></li>
</ul></li>
<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames">Object.getOwnPropertyNames</a></p>

<ul>
<li><p>전달된 <strong>객체</strong> <strong>속성</strong>(<span style="color:#c11f1f">상속받은 속성이 제외된 속성 중</span>)으로 이루어진 <strong>배열</strong>을 반환한다.(<strong>Enumerable</strong> 또는 <strong>Nonenumerable</strong> 속성이 모두 포함된다)</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>

<span class="c1">// 객체의 x 속성을 enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">1</span>
<span class="p">});</span>

<span class="c1">// 객체의 y 속성을 non-enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">2</span>
<span class="p">});</span>

<span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="c1">// enumerable or non-enumerable 속성 이름으로 이루어진 배열을 반환한다.</span>
<span class="c1">// 이전과 마찬가지로 상속받은 z 속성은 제외된다.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">(</span><span class="nx">obj</span><span class="p">));</span> <span class="c1">// [&quot;x&quot;, &quot;y&quot;]</span>
</code></pre></div></li>
</ul></li>
</ul></li>
<li><p><strong>반복</strong>(Iteration)</p>

<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys">Object.keys</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames">Object.getOwnPropertyNames</a></li>
<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...in">for...in 문</a></p>

<ul>
<li>전달된 <strong>객체</strong> 속성을(<span style="color:#c11f1f">상속받은 속성이 모두 포함된</span>) 모두 <strong>순회</strong>한다.</li>
<li><p>이전 <strong>built-in 수단</strong>들과 달리, <u>상속받은 <strong>속성</strong>이 모두 포함된다.</u></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>

<span class="c1">// 객체의 x 속성을 enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">1</span>
<span class="p">});</span>

<span class="c1">// 객체의 y 속성을 non-enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">2</span>
<span class="p">});</span>

<span class="c1">// 객체 원형을 확장한 z 속성을 enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">3</span>
<span class="p">});</span>

<span class="c1">// 객체 원형을 확장한 t 속성을 non-enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">4</span>
<span class="p">});</span>

<span class="c1">// 모든 enumerable 속성을 순회한다.(자신이 소유한 속성 및 상속받은 속성)</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">n</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">){</span>
    <span class="c1">// enumerable 속성만을 가져온다.</span>
    <span class="c1">// x: 자신이 소유한 enumerable 속성, z: 상속받은 enumerable 속성</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span> <span class="c1">// x, z</span>

<span class="p">}</span>
</code></pre></div></li>
</ul></li>
</ul></li>
</ul></li>
<li><p>non-enumerable 속성만을 가져오기</p>

<ul>
<li><p>언급된 <strong>built-in 수단</strong>들의 <strong>특성</strong>을 이용하여, <span style="color:#c11f1f">자신이 소유한 <strong>속성</strong> 중</span> <strong>non-enumerable</strong> 속성만을 가져오는 <strong>예제</strong>를 만들어보았다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>

<span class="c1">// 객체의 x 속성을 enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">1</span>
<span class="p">});</span>

<span class="c1">// 객체의 y 속성을 non-enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">2</span>
<span class="p">});</span>

<span class="c1">// 확장할 객체 원형의 z 속성을 enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">3</span>
<span class="p">});</span>

<span class="c1">// 확장할 객체 원형의 t 속성을 non-enumerable 로 정의한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mi">4</span>
<span class="p">});</span>

<span class="c1">// getOwnPropertyNames 메서드를 통해 자신이 소유한 속성들을 순회한다.</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">Object</span><span class="p">,</span> <span class="nx">obj</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">prop</span><span class="p">){</span>

    <span class="c1">// propertyIsEnumerable 메서드를 통해 해당 속성의 enumerable 유/무를 반환한다.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">propertyIsEnumerable</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)){</span>

        <span class="c1">// non-enumerable 속성만을 가져온다.</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;non-enumerable property: &#39;</span> <span class="o">+</span> <span class="nx">prop</span><span class="p">);</span> <span class="c1">// non-enumerable property: y</span>
        <span class="c1">// getOwnPropertyDescriptor 메서드를 통해 속성에 내용을 기술한다.</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyDescriptor</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">));</span> <span class="c1">// y property descriptor</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></li>
</ul></li>
</ul>

<h2 id="2">2. 참고 사이트</h2>

<ul>
<li><p>아래 <strong>페이지</strong>에서 <strong>enumerability</strong> 관련 메서드들을 정리한 <strong>라이브러리</strong>를 제공하고 있다.(관련 소스 작성 시 반드시 <strong>참고</strong>하기 바란다)</p>

<ul>
<li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Enumerability_and_ownership_of_properties">Enumerability and ownership of properties</a></li>
</ul></li>
</ul>

        </article>
        <p style="text-align: right"><a href="/blog/javascript/2015/10/09/enumerable-inJS/">Read more</a></p>
        <hr style="margin-bottom:30px; border:0; border-bottom: 1px dotted #ccc;" />
    </li>
  
      <li>
          <header class="post-header">
            <h1 itemprop="name" class="post-title">
              <a itemprop="url" class="post-link" href="/blog/javascript/2015/09/15/Selection/">Selection</a>
            </h1>
            <div class="tags cf">
              
                <a href="/blog/search/?category=javascript">javascript</a>&nbsp;
              
              <time itemprop="datePublished" datetime="2015-09-15">
                Sep 15, 2015
              </time>
            </div>
        </header>

        <article style="position: relative; width: 100%; height: 400px; overflow-y: hidden; margin-bottom: 15px;">
          <h2 id="selection"><strong>Selection</strong></h2>

<ul>
<li>정의

<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Selection">Selection</a> 은 마우스 또는 키보드를 통해, 컨텐츠를 <u><strong>선택</strong></u>, 또는 <u><strong>선택된 영역을 제어</strong></u> 하기위한 모든 특성들을 제공한다.</li>
</ul></li>
</ul>

<h2 id="><strong>관련 용어</strong></h2>

<ul>
<li><p>정의</p>

<ul>
<li><strong>Selection</strong> 에 대해 공부할때, 가장 큰 장애물이 되는것은, 각 <strong>용어</strong>에 대한 <strong>이해도</strong>라 생각한다. 즉 <u><strong>용어</strong></u>에 대한 정확한 이해없이는, 제공되는 <strong>API</strong> 기능에 대해 이해하기 힘든 부분이 존재하기 때문이다.</li>
</ul></li>
<li><p>용어 설명</p>

<ul>
<li><span style="color:#c11f1f">Selection / Selection object</span>: 사용자가 마우스(드래그) 또는 키보드(키 조작)를 통해, <u><strong>선택된 텍스트</strong></u>의 <strong>범위</strong>를 말한다.</li>
<li><span style="color:#c11f1f">anchor</span>: 선택된 범위가 <strong>시작되는 지점</strong>을 말한다.</li>
<li><span style="color:#c11f1f">focus</span>: 선택된 범위가 <strong>끝나는 지점</strong>을 말한다.</li>
<li><span style="color:#c11f1f">range</span>: 선택된 범위의 <strong>문서 조각</strong>들을 말한다.</li>
</ul></li>
</ul>

<h2 id="><strong>특성</strong></h2>

<ul>
<li><p><strong>Properties</strong></p>

<p>이와같은 <strong>HTML</strong> 코드가 있다고 가정하고, 아래 나열된 속성들을 살펴보기로한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c">&lt;!--</span> <span class="nx">container</span> <span class="err">객체</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;text-container&quot;</span> <span class="nx">contenteditable</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&quot;height: 20px&quot;</span><span class="o">&gt;</span><span class="nx">HELLO</span><span class="o">&lt;</span><span class="err">/span&gt;</span>
    <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&quot;height: 20px;padding-left: 5px;&quot;</span><span class="o">&gt;</span><span class="nx">WORLD</span><span class="o">&lt;</span><span class="err">/span&gt;</span>
    <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&quot;height: 20px;padding-left: 5px;&quot;</span><span class="o">&gt;</span><span class="nx">TEST</span><span class="o">&lt;</span><span class="err">/span&gt;</span>
    <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&quot;height: 20px;padding-left: 5px;&quot;</span><span class="o">&gt;!!!!&lt;</span><span class="err">/span&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</code></pre></div>
<ul>
<li><p><span style="color:#6298c1">selection.anchorNode</span>:</p>

<p>선택된 범위가 시작되는 지점의 노드를 반환한다.</p></li>
<li><p><span style="color:#6298c1">selection.anchorOffset</span>:</p>

<p>anchorNode 범위내에 anchor(선택된 범위가 시작되는 지점) 이전의 문자열(<strong>HE(2개)</strong>)의 갯수를 반환한다.</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/Selection/selection_1.jpg" alt=""></p></li>
<li><p><span style="color:#6298c1">selection.focusNode</span>:</p>

<p>선택된 범위가 끝나는 지점의 노드를 반환한다.</p></li>
<li><p><span style="color:#6298c1">selection.focusOffset</span>:</p>

<ul>
<li>focusNode 범위내에 focus(선택된 범위가 끝나는 지점)의 문자열(<strong>WORLD(5개)</strong>) 갯수를 반환한다.</li>
</ul>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/Selection/selection_2.jpg" alt=""></p></li>
<li><p><u><span style="color:#6298c1">anchorOffset</span> 과 <span style="color:#6298c1">focusOffset</span> 이 좀 이해하기 힘들더라도(개인적일수도 있지만;;;) 그만큼 중요한 부분이니, 반드시 <strong>이해</strong>하고 넘어가길 바란다.</u></p></li>
<li><p><span style="color:#6298c1">selection.isCollapsed</span>:</p>

<ul>
<li>선택된 범위가 시작되는 지점(<span style="color:#6298c1">anchorOffset</span>)과, 끝나는 지점(<span style="color:#6298c1">focusOffset</span>)이 동일한지 여부를 반환한다.</li>
<li><p>만약 첫 번째 문자와 두 번째 문자 사이를 <strong>클릭</strong>(<span style="color:#6298c1">드래그</span>가 아닌)한 경우, <span style="color:#6298c1">anchorOffset</span> 과 <span style="color:#6298c1">focusOffset</span> 은 각각 <span style="color:#c11f1f">1</span>을 반환하게 된다.</p>

<ul>
<li>선택이 시작된 지점 <strong>이전의 문자열(H)</strong> 갯수(anchorOffset): <span style="color:#c11f1f">1</span></li>
<li>선택이 <strong>끝난 지점의 문자열(H)</strong> 갯수(focusOffset): <span style="color:#c11f1f">1</span></li>
</ul></li>
</ul>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/Selection/selection_3.jpg" alt=""></p></li>
<li><p><span style="color:#6298c1">selection.rangeCount</span>:</p>

<ul>
<li>선택된 범위의 <span style="color:#6298c1">range</span> 크기를 반환한다.</li>
<li>페이지 로드 후 <u>사용자가 문서를 <strong>클릭</strong>하지 않았을경우</u>, <span style="color:#6298c1">rangeCount</span> 는 <span style="color:#c11f1f">0</span>을, <strong>클릭한 후</strong>에는 <span style="color:#c11f1f">1</span>을 반환하게 된다.</li>
<li>사용자는 <u>일반적으로 한번에 하나의 <span style="color:#6298c1">range</span> 를 선택할 수 있다.</u></li>
<li><p><u><strong>Gecko</strong> 브라우저에서는 Multiple <span style="color:#6298c1">range</span> 를 선택할 수 있다.</u>(Ctrl or Command 키를 통해)</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/Selection/selection_4.jpg" alt=""></p></li>
</ul></li>
</ul></li>
<li><p><strong>Methods</strong></p>

<ul>
<li><p><span style="color:#6298c1">selection.getRangeAt(range index)</span>:</p>

<ul>
<li>선택된 하나의 <span style="color:#6298c1">range object</span> 를 반환한다.</li>
</ul></li>
<li><p><span style="color:#6298c1">selection.collapse(parentNode, offset)</span>:</p>

<ul>
<li><span style="color:#6298c1">anchorNode</span> 를 전달된 offset 으로 지정한다.</li>
</ul></li>
<li><p><span style="color:#6298c1">selection.extend(parentNode, offset)</span>:</p>

<ul>
<li><p><span style="color:#6298c1">focusNode</span> 를 전달된 offset 으로 지정한다.</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/Selection/selection_5.jpg" alt=""></p></li>
</ul></li>
<li><p>anchorNode 와 focusNode 를 각각의 메서드를 통해 <u>새로 지정하면, 새로운 <strong>선택</strong> 범위를 만들어낼수 있다.</u></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">selection</span><span class="p">.</span><span class="nx">collapse</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="nx">selection</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nx">anchorNode</span><span class="p">);</span> <span class="c1">// HELLO</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nx">focusNode</span><span class="p">);</span> <span class="c1">// HELLO</span>

<span class="nx">selection</span><span class="p">.</span><span class="nx">collapse</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nx">selection</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nx">anchorNode</span><span class="p">);</span> <span class="c1">// WORLD</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nx">focusNode</span><span class="p">);</span> <span class="c1">// TEST</span>

<span class="nx">selection</span><span class="p">.</span><span class="nx">collapse</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="nx">selection</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nx">anchorNode</span><span class="p">);</span> <span class="c1">// !!!!</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nx">focusNode</span><span class="p">);</span> <span class="c1">// !!!!</span>
</code></pre></div></li>
<li><p><span style="color:#6298c1">selection.collapseToStart()</span>:</p>

<ul>
<li>선택된 범위가 시작되는 지점으로 <strong>커서</strong>를 이동시킨다.</li>
</ul></li>
<li><p><span style="color:#6298c1">selection.collapseToEnd()</span>:</p>

<ul>
<li>선택된 범위가 끝나는 지점으로 <strong>커서</strong>를 이동시킨다.</li>
</ul></li>
<li><p><span style="color:#6298c1">selection.selectAllChildren(parentNode)</span>:</p>

<ul>
<li>이전에 선택된 범위를 <strong>취소</strong>(삭제)한 후, 전달된 parentNode 의 모든 자식 노드들을 선택 한다.</li>
</ul></li>
<li><p><span style="color:#6298c1">selection.addRange(range)</span>:</p>

<ul>
<li><p>새로운 range(선택 범위의 문서 조각) 를 추가한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;text-container&quot;</span><span class="p">);</span>

<span class="c1">// container 의 모든 자식 노드들에 대한 range object 를 생성 후 addRange 메서드를 통해, 선택 범위에 추가시킨다.</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">container</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>

    <span class="kd">var</span> <span class="nx">childNode</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">range</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createRange</span><span class="p">();</span>

    <span class="nx">range</span><span class="p">.</span><span class="nx">selectNode</span><span class="p">(</span><span class="nx">childNode</span><span class="p">);</span>

    <span class="c1">// 새로운 range(선택 범위의 문서 조각) 를 추가한다.</span>
    <span class="nx">selection</span><span class="p">.</span><span class="nx">addRange</span><span class="p">(</span><span class="nx">range</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><img src="http://mohwa.github.io/blog/assets/images/posts/Selection/selection_6.jpg" alt=""></p></li>
</ul></li>
<li><p><span style="color:#6298c1">selection.removeAllRanges()</span>:</p>

<ul>
<li>모든 range(선택된 범위의 문서 조각)를 삭제한다.</li>
</ul></li>
<li><p><span style="color:#6298c1">selection.deleteFromDocument()</span>:</p>

<ul>
<li>선택된 범위의 모든 text 를 삭제한다.</li>
</ul></li>
<li><p><span style="color:#6298c1">selection.toString()</span>:</p>

<ul>
<li>선택된 범위의 모든 컨텐츠를 반환한다.</li>
</ul></li>
<li><p><span style="color:#6298c1">selection.containsNode(aNode, aPartlyContained)</span>:</p>

<ul>
<li>전달된 노드(<strong>aNode</strong>)가 선택된 범위안에 있는지 여부를 반환한다.</li>
</ul>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/Selection/selection_6.jpg" alt=""></p>

<p>위 그림에서와 같이 <span style="color:#6298c1">helloNode</span> 는 <u>선택된 범위에 포함되지 않기때문에</u>, <span style="color:#c11f1f">false</span> 를 <strong>반환</strong>하게 되며, <span style="color:#6298c1">worldNode</span> 는 그 반대인 <span style="color:#c11f1f">true</span> 를 <strong>반환</strong>하게 된다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;text-container&quot;</span><span class="p">);</span>

<span class="c1">// hello 문자열 노드</span>
<span class="kd">var</span> <span class="nx">helloNode</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
<span class="c1">// world 문자열 노드</span>
<span class="kd">var</span> <span class="nx">worldNode</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nx">containsNode</span><span class="p">(</span><span class="nx">helloNode</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span> <span class="c1">// false</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">selection</span><span class="p">.</span><span class="nx">containsNode</span><span class="p">(</span><span class="nx">worldNode</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span> <span class="c1">// true</span>
</code></pre></div></li>
</ul></li>
</ul>

<h2 id="api"><strong>API 테스트</strong></h2>

<p>아래 코드는 <strong>Chrome</strong> 브라우저에서만 테스트되었습니다.(소스 참조시 반드시 다른 브라우저에서도 테스트 하시기 바랍니다)</p>

<iframe width="100%" height="600" src="http://jsfiddle.net/mohwa/3bd9vao3/1/embedded/result,html" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

        </article>
        <p style="text-align: right"><a href="/blog/javascript/2015/09/15/Selection/">Read more</a></p>
        <hr style="margin-bottom:30px; border:0; border-bottom: 1px dotted #ccc;" />
    </li>
  
      <li>
          <header class="post-header">
            <h1 itemprop="name" class="post-title">
              <a itemprop="url" class="post-link" href="/blog/javascript/2015/08/31/binary-inJS/">JavaScript 를 통해 Binary Data 조작하기</a>
            </h1>
            <div class="tags cf">
              
                <a href="/blog/search/?category=javascript">javascript</a>&nbsp;
              
              <time itemprop="datePublished" datetime="2015-08-31">
                Aug 31, 2015
              </time>
            </div>
        </header>

        <article style="position: relative; width: 100%; height: 400px; overflow-y: hidden; margin-bottom: 15px;">
          <h2 id="1">1. 사전 지식</h2>

<ul>
<li><p><strong>Blob</strong></p>

<ul>
<li>정의

<ul>
<li><strong>Blob</strong> 는 일반적으로 미디어(이미지, 사운드, 비디오) 파일과 같은 큰 용량의 파일을 말한다.</li>
</ul></li>
<li><p>Blob Object</p>

<ul>
<li><p>Blob Object 는 File 과 같은 <strong>불변 객체</strong>를 나타내며, <strong>raw data</strong> 를 가진다.</p>

<ul>
<li>추가로 <span style="color:#6298c1">File 인터페이스</span> 는 <strong>Blob 인터페이스</strong> 의 모든 특성들을 상속받는다.</li>
</ul>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/bytesManipulation_1.jpg" alt=""></p></li>
</ul></li>
<li><p><a href="https://developer.mozilla.org/en/docs/Web/API/Blob">Blob API in MDN</a></p></li>
<li><p><a href="http://www.terms.co.kr/BLOB.htm">Blob in Terms</a></p></li>
<li><p><a href="http://caniuse.com/#search=blob">Blob in Can I Use</a></p></li>
</ul></li>
<li><p><strong>JavaScript Typed Array</strong></p>

<ul>
<li><p>정의</p>

<ul>
<li><p><strong>Typed Array</strong> 는 raw binary data 에 접근하기 위한 방법을 제공한다.</p>

<ul>
<li><em>즉 자바스크립트로 <span style="color:#c11f1f">binary data</span> 를 다루기 위해 사용한다.</em></li>
</ul></li>
<li><p><strong>유연성</strong>과 <strong>효율성</strong>을 위해 <span style="color:#c11f1f">buffer</span> 와 <span style="color:#c11f1f">view</span> 로 나눠 구현되어있다.</p>

<ul>
<li><p>buffer</p>

<ul>
<li><span style="color:#6298c1">ArrayBuffer</span> 는 고정된 크기의 raw binary data 를 나타내기 위해 사용된다.</li>
<li><p><span style="color:#6298c1">ArrayBuffer</span> 클래스 통해 생성된  <span style="color:#c11f1f">buffer</span> 는 <strong>데이터 청크</strong>를 나타내는 객체이다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// 12 bytes buffer 나타낸다</span>
<span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span>
</code></pre></div></li>
<li><p><span style="color:#c11f1f">buffer</span> 는 <u>저장된 <strong>데이터</strong>를 접근하기 위한 방법을 제공하지 않는다.</u></p></li>
<li><p>데이터를 다루기 위해서는 반드시 <span style="color:#c11f1f">view</span> 를 사용해야한다.</p></li>
</ul></li>
<li><p>view</p>

<ul>
<li><p>DataView</p>

<p><span style="color:#6298c1">DataView</span> <span style="color:#c11f1f">view</span> 는 <span style="color:#c11f1f">buffer</span> 에 저장된 데이터로 부터 값을 <strong>읽고</strong>, <strong>쓰기</strong> 위한 <span style="color:#6298c1">low-level 인터페이스</span> 를 제공한다.(getter/setter API 제공)</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// 12 bytes byffer</span>
<span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span>
<span class="c1">// view 를 생성한다.</span>
<span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DataView</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// 해당 view 가 시작하는 위치를 반환한다.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">byteOffset</span><span class="p">);</span> <span class="c1">// 2</span>
</code></pre></div>
<p>데이터를 다루기위한 DataView 의 특성들은 아래와 같다.</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/bytesManipulation_4.jpg" alt=""></p></li>
<li><p><span style="color:#6298c1">Typed Array Views</span></p>

<p><span style="color:#6298c1">DataView</span> 를 상속한 아래 <strong>클래스</strong>들을 통해 <span style="color:#c11f1f">buffer</span> 에 저장된 데이터를 다룰 수 있게된다.</p>

<p><strong>Int8Array</strong>, <strong>Uint8Array</strong>, <strong>Int32Array</strong>, <strong>Uint32Array</strong> 등 ...</p>

<p>위 클래스 중 <span style="color:#6298c1">Int32Array</span> 를 통해 생성된 <span style="color:#c11f1f">view</span> 는 아래와 같은 특성들을 가지게된다.</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/bytesManipulation_3.jpg" alt=""></p>

<p>아래 그림은 각 <span style="color:#c11f1f">view</span> 에 따라 나눠지는 메모리 공간을 나타낸다.</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/bytesManipulation_2.jpg" alt=""></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/*</span>

<span class="cm">ArrayBuffer(20 bytes)</span>
<span class="cm">8bit == 1 byte</span>

<span class="cm">ArrayBuffer / 1 byte = 20;</span>

<span class="cm"> */</span>
<span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="c1">// 부호 없는 1 byte 정수 배열</span>
<span class="kd">var</span> <span class="nx">uint8View</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">buffer</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">uint8View</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// 20</span>

<span class="cm">/*</span>

<span class="cm"> ArrayBuffer(20 bytes)</span>
<span class="cm"> 32bit == 4 byte</span>

<span class="cm"> ArrayBuffer / 4 byte = 5;</span>

<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="c1">// 부호 없는 4 byte 정수 배열</span>
<span class="kd">var</span> <span class="nx">uint32View</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint32Array</span><span class="p">(</span><span class="nx">buffer</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">uint32View</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// 5</span>
</code></pre></div>
<p>unsigned or signed view test</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// unsigned int 8(1 bytes)</span>

<span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">uint8View</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">buffer</span><span class="p">);</span>

<span class="c1">// 0 ~ 255(unsigned int 8(1 bytes) 로 표현 가능한 수)</span>
<span class="nx">uint8View</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nx">uint8View</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">uint8View</span><span class="p">);</span> <span class="c1">// [0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</span>

<span class="c1">// signed int 8(1 bytes)</span>

<span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">int8View</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Int8Array</span><span class="p">(</span><span class="nx">buffer</span><span class="p">);</span>

<span class="c1">// -127 ~ 128(signed int 8(1 bytes) 로 표현 가능한 수)</span>

<span class="c1">// signed 의 경우 부호(양수/음수)를 나타내기 위해 총 8bit 중 1 비트(0: 양수, 1: 음수) 사용하기 때문에, 나머지 7bit(-127 ~ 128(표현 가능한 수))를 통해 숫자를 표현하게 된다.</span>

<span class="nx">int8View</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">128</span><span class="p">;</span>
<span class="nx">int8View</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">int8View</span><span class="p">);</span> <span class="c1">// [-128, 127, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</span>

<span class="c1">// unsigned int 16(2 bytes)</span>
<span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">uint16View</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint16Array</span><span class="p">(</span><span class="nx">buffer</span><span class="p">);</span>

<span class="c1">// 0 ~ 65535(unsigned int 16(2 bytes) 로 표현 가능한 수)</span>
<span class="nx">uint16View</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">uint16View</span><span class="p">);</span> <span class="c1">// [65535, 0, 0, 0, 0, 0, 0, 0, 0, 0]</span>
</code></pre></div></li>
</ul></li>
</ul></li>
<li><p><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a></p></li>
<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView">DataView</a></p></li>
<li><p><a href="http://www.javascripture.com/DataView">DataView API Test</a></p></li>
<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays">JavaScript Typed Arrays</a></p></li>
<li><p><a href="http://ohgyun.com/418">JavaScript Typed Arrays(번역)</a></p></li>
<li><p><a href="http://firejune.com/1791/">signed 와 unsigned 의 차이</a></p></li>
<li><p><a href="http://air802.tistory.com/52">signed 가 음수 표현하는 방법(상세 설명)</a></p></li>
<li><p><a href="http://libsora.so/posts/i-hate-unsigned/">나는 unsigned 가 싫어요</a></p></li>
<li><p><a href="http://blog.naver.com/dud5243_/220415835594">signed or unsigned 자료형의 범위</a></p></li>
<li><p><a href="http://www.binaryconvert.com/index.html">Binary Convert</a></p></li>
</ul></li>
</ul></li>
<li><p><strong>Little-Endian or Big-Endian</strong></p>

<ul>
<li><p>정의</p>

<ul>
<li><span style="color:#6298c1">Endian</span> 은 컴퓨터에서 데이터가 저장되는 순서(<span style="color:#c11f1f">byte order</span>)를 말한다.</li>
<li><img src="http://mohwa.github.io/blog/assets/images/posts/bytesManipulation_5.jpg" alt=""></li>
<li><p>정리:</p>

<ul>
<li>메모리는 <span style="color:#c11f1f">하위 주소</span>에서 <span style="color:#c11f1f">상위 주소</span>로 데이터가 저장된다.</li>
<li><p><span style="color:#c11f1f">Little Endian</span>: <span style="color:#6298c1">하위 바이트</span>부터 데이터가 저장되는 방식.</p>

<ul>
<li><span style="color:#c11f1f">Little Endian</span> 방식의 장점: 산술연산유닛(ALU)에서 메모리를 읽는 방식이 메모리 주소가 낮은 쪽에서부터 높은 쪽으로 읽기 때문에 산술 연산의 수행이 더 쉽다.(<em>연산 처리 과정에서 이런 장점이 있는 정도로만 알고 넘어가자...</em>)</li>
</ul></li>
<li><p><img src="http://mohwa.github.io/blog/assets/images/posts/bytesManipulation_6.jpg" alt=""></p></li>
<li><p><span style="color:#c11f1f">Big Endian</span>: <span style="color:#6298c1">상위 바이트</span>부터 데이터가 저장되는 방식.</p></li>
<li><p><img src="http://mohwa.github.io/blog/assets/images/posts/bytesManipulation_7.jpg" alt=""></p></li>
</ul></li>
</ul></li>
<li><p>적용 이유:</p>

<ul>
<li>각 <u><strong>CPU</strong>(Intel / Spac) <strong>타입</strong>에 따라 <span style="color:#6298c1">차이</span>를 보이는 <span style="color:#c11f1f">byte order</span>(<strong>데이터 저장 순서</strong>)</u>는, 동일한 시스템 안에서만 데이터를 주고 받는다면, <span style="color:#c11f1f">Endian</span> 에 대해 전혀 신경쓸 필요가 없지만, <u><span style="color:#6298c1">이기종간</span>에 데이터를 주고 받을 경우</u>, 서로간의 <strong>데이터 저장 방식 차이</strong>로 인해 전혀 엉뚱한 결과를 반환하게 된다.</li>
</ul></li>
<li><p>서로 다른 Endian 간의 데이터 통신 해결책:</p>

<ul>
<li><p>공통되는 Endian(<u>약속된 <span style="color:#c11f1f">Endian</span> 규칙</u>)으로 <span style="color:#6298c1">변환</span> 후, 데이타를 주고/받는 방법.</p>

<ul>
<li>즉 서로간에 사용할 <strong>Endian</strong>(<span style="color:#c11f1f">Little Endian</span> or <span style="color:#c11f1f">Big Endian</span>) 을 하나로 통일시켜 데이터를 주고 받는 것이다.</li>
</ul></li>
<li><p>또 하나의 방법은 <span style="color:#c11f1f">byte order</span>(바이트 저장 순서) 를 신경쓸 필요가 없는, <strong>데이터 타입</strong>을 사용하는 것이다. <span style="color:#c11f1f">char</span> 타입은 <strong>1byte</strong> 의 크기를 가지기때문에, <span style="color:#c11f1f">byte order</span> 에 대해 전혀 신경쓸 필요가 없다. 예를 들면 12345678 을 int 형으로 보내는 대신 <strong>문자열</strong> &quot;12345678&quot; 로 변환시켜 <span style="color:#6298c1">전송</span>하면 된다.</p></li>
</ul></li>
<li><p><a href="https://ko.wikipedia.org/wiki/%EC%97%94%EB%94%94%EC%96%B8">엔디언</a></p></li>
<li><p><a href="http://t3zz-so4.tistory.com/entry/Little-Endian-Big-Endian">Little-Endian or Big-Endian(개념 잡기 좋은 문서)</a></p></li>
<li><p><a href="http://firejune.com/1790">Little-Endian or Big-Endian 개념</a></p></li>
<li><p><a href="http://www.joinc.co.kr/modules/moniwiki/wiki.php/Site/Network_Programing/Documents/">Endian 에 대해서</a></p></li>
</ul></li>
</ul>

<h2 id="2-javascript-binary-data">2. JavaScript 를 통해 Binary Data 조작하기</h2>

<ul>
<li><p><span style="color:#6298c1">예제 소스</span>에서는 <strong>NodeJS</strong> 및 <strong>Socket.IO</strong> 와 관련된 내용은 최대한 배제 하였습니다.(특별히 포스트 내용과 관련 없다고 판단한 내용)</p></li>
<li><p><strong>파일 업로드</strong></p>

<ul>
<li><p><span style="color:#6298c1">File</span> 및 <span style="color:#6298c1">FileReader API</span> 를 지원하는 브라우저를 통해 파일 업로드 기능을 만들 수 있다.</p>

<ul>
<li>하지만 <em>IE(10/11 포함) 브라우저는 지원하지 않는다고 보면된다.</em></li>
<li><p>Source Example</p>

<ul>
<li>Cliend Side(use JS)</li>
<li><p>먼저 저장소로 부터 내려받은 파일을 include 한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;siofu_client.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// socket 서버에 연결</span>
<span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">&#39;http://localhost:9090&#39;</span><span class="p">);</span>

<span class="c1">// socket 객체를 SocketIOFileUpload 클래스로 전달한다.</span>
<span class="kd">var</span> <span class="nx">uploader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SocketIOFileUpload</span><span class="p">(</span><span class="nx">socket</span><span class="p">);</span>

<span class="c1">// listenOnSubmit 메서드에 input[type=&quot;button&quot;] 및 input[type=&quot;file&quot;] Element 를 전달한다.</span>
<span class="nx">uploader</span><span class="p">.</span><span class="nx">listenOnSubmit</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#btn_upload&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#siofu_input&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

<span class="c1">// KiB === byte 단위</span>
<span class="c1">// KB === KByte 단위</span>

<span class="c1">// 한번에 로드될 chunks 파일 사이즈</span>
<span class="c1">// chunkSize 를 0으로 할당하면, chunk 를 사용하지 않게 된다.</span>
<span class="nx">uploader</span><span class="p">.</span><span class="nx">chunkSize</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span> <span class="c1">// 102400 byte 로 chunk 단위를 나눈다.</span>

<span class="nx">uploader</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;started upload of file&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// progress 이벤트를 통해 현재 진행 상황을 볼 수 있다.</span>
<span class="nx">uploader</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;progress&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">percent</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">bytesLoaded</span> <span class="o">/</span> <span class="nx">event</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">size</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;File is&quot;</span><span class="p">,</span> <span class="nx">percent</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;percent loaded&quot;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// 파일 업로드가 끝날을때 이벤트가 발생한다.</span>
<span class="nx">uploader</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;complete&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;completed file upload&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></li>
<li><p>Server Side(use nodeJS)</p></li>
</ul>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="kd">var</span> <span class="nx">uploader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">siofu</span><span class="p">();</span>
    <span class="nx">uploader</span><span class="p">.</span><span class="nx">dir</span> <span class="o">=</span> <span class="s2">&quot;uploads&quot;</span><span class="p">;</span>
    <span class="nx">uploader</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">socket</span><span class="p">);</span>

    <span class="c1">// Do something when a file is saved:</span>
    <span class="nx">uploader</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;saved&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">file</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="c1">// Error handler:</span>
    <span class="nx">uploader</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Error from uploader&quot;</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div></li>
<li><p>참고 사이트</p>

<p><a href="https://github.com/vote539/socketio-file-upload#instancelistenoninputinput">socket io file upload module</a></p>

<p><a href="http://caniuse.com/#search=file%20api">File API</a></p>

<p><a href="http://caniuse.com/#search=FileReader">FileReader API</a></p></li>
</ul></li>
</ul></li>
<li><p><strong>이미지 효과</strong></p>

<ul>
<li>서버에서 내려받은 <span style="color:#6298c1">ArrayBuffer</span>(<strong>이미지</strong> 데이터) 로 <span style="color:#c11f1f">view</span>(uInt8Array) 를 생성 후, 버퍼에 저장된 데이터를 조작한다.</li>
<li><p>Source Example</p>

<ul>
<li><p>Cliend Side(use JS)</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">cw</span> <span class="o">=</span> <span class="mi">327</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">ch</span> <span class="o">=</span> <span class="mi">125</span><span class="p">;</span>

<span class="c1">// canvas Element 를 가져온다.</span>
<span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">);</span>

<span class="c1">// context 를 생성한다.</span>
<span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>

<span class="c1">// view(부호 없는 1byte 정수 배열)를 생성한다.</span>
<span class="kd">var</span> <span class="nx">uInt8Array</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">buffer</span><span class="p">);</span>

<span class="c1">// view를 통해 Blob Object 를 생성한다.</span>
<span class="kd">var</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">uInt8Array</span><span class="p">],</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;image/jpeg&#39;</span><span class="p">});</span>

<span class="kd">var</span> <span class="nx">originalImgData</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="c1">// Blob Object를 참조하는 URL를 생성한다.</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">;</span>

<span class="c1">// 이미지 로드 이벤트</span>
<span class="nx">$</span><span class="p">(</span><span class="nx">img</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">img</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">img</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>

    <span class="c1">// 캔버스에 해당 이미지를 그린다.</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">img</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">img</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

    <span class="c1">// 각 px 에 대한 정보(r,g,b,a)가 담긴 이미지 데이터를 가져온다.</span>
    <span class="nx">originalImgData</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

    <span class="c1">// 반전 효과를 준다.</span>
    <span class="c1">// invert();</span>

    <span class="c1">// 흑백 효과를 준다.</span>
    <span class="nx">empty</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// Blob 객체를 참조하는 URL을 img.src 에 할당 후 로드한다.</span>
<span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>

<span class="c1">// px 단위의 이미지 데이터를 조작하여, 반전 효과를 준다.</span>
<span class="kd">function</span> <span class="nx">invert</span><span class="p">(){</span>

    <span class="nx">originalImgData</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">originalImgData</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>     <span class="c1">// red</span>
        <span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span> <span class="c1">// green</span>
        <span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span> <span class="c1">// blue</span>
    <span class="p">}</span>

    <span class="nx">ctx</span><span class="p">.</span><span class="nx">putImageData</span><span class="p">(</span><span class="nx">originalImgData</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">));</span>
<span class="p">};</span>

<span class="c1">// px 단위의 이미지 데이터를 조작하여, 흑백 효과를 준다.</span>
<span class="kd">function</span> <span class="nx">empty</span><span class="p">(){</span>

    <span class="nx">originalImgData</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">originalImgData</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// 각 픽셀의 밝기만 조사하여 R, G, B 색상 요소를 균일하게 만들면 회색이 된다.(색상 정보를 아래 공식(각 요소(R, G, B)가 밝기에 미치는 영향은 29:58:11로 전문가에 의해 계산되어 있다)으로 R,G,B 요소에서 제거한다)</span>

        <span class="c1">// 128 이상은 흰색으로, 128 이하는 검정색으로 만들어 버림으로써, 흰색과 검정색 두 가지만 남긴다. 경계값인 128을 조정하면 밝기가 달라진다.</span>
        <span class="kd">var</span> <span class="nx">gray</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.299</span> <span class="o">+</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.587</span> <span class="o">+</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.114</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">gray</span> <span class="o">&gt;</span> <span class="mi">128</span><span class="p">){</span>
            <span class="nx">gray</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="nx">gray</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">gray</span><span class="p">;</span>     <span class="c1">// red</span>
        <span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">gray</span><span class="p">;</span> <span class="c1">// green</span>
        <span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">gray</span><span class="p">;</span> <span class="c1">// blue</span>
    <span class="p">}</span>

    <span class="nx">ctx</span><span class="p">.</span><span class="nx">putImageData</span><span class="p">(</span><span class="nx">originalImgData</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></li>
<li><p>Server Side(use nodeJS)</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="c1">// 파일을 읽은 후 클라이언트로 버퍼를 전달한다.</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">&#39;./lib/img/nmms_20823487.jpg&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">buf</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// it&#39;s possible to embed binary data</span>
    <span class="c1">// within arbitrarily-complex objects</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;onSocketMsg&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;resultImageData&#39;</span><span class="p">,</span>
        <span class="nx">payload</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">buffer</span><span class="o">:</span> <span class="nx">buf</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></li>
</ul></li>
<li><p>적용 결과</p>

<ul>
<li><p>원본 이미지</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/bytesManipulation_8.jpg" alt=""></p></li>
<li><p>invert 함수 적용 이미지</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/bytesManipulation_9.jpg" alt=""></p></li>
<li><p>empty 함수 적용 이미지</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/bytesManipulation_10.jpg" alt=""></p></li>
</ul></li>
<li><p>참고 사이트</p>

<ul>
<li><a href="chrome://blob-internals/">생성된 Blob 객체 확인(in Chrome)</a></li>
<li><a href="http://caniuse.com/#search=createObjectURL">Blob URLs</a></li>
<li><a href="http://code.flickr.net/2012/06/01/parsing-exif-client-side-using-javascript-2/">EXIF(이미지 정보) IN JS</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas">Pixel manipulation with canvas</a></li>
<li><a href="http://www.phpied.com/pixel-manipulation-in-canvas/">Pixel manipulation in canvas(이미지 효과에 대한 예제 및 자세한 설명)</a></li>
<li><a href="http://www.soen.kr/html5/html3/3-2-2.htm">이미지 데이터 효과(한글 문서)</a></li>
</ul></li>
</ul></li>
<li><p><strong>ArrayBuffer 로 내려받은 비디오 플레이</strong></p>

<ul>
<li><p>서버에서 내려받은 <span style="color:#6298c1">ArrayBuffer</span>(<strong>영상</strong> 데이터) 로 <span style="color:#c11f1f">view</span>(in Typed Array Views) 를 생성 후, 버퍼에 저장된 데이터를 조작한다.</p>

<ul>
<li><strong>영상</strong> 및 오디오 데이터의 경우, <span style="color:#c11f1f">브라우저 지원 여부</span> 및 <span style="color:#c11f1f">지원 포맷</span>에 대해 반드시 확인해봐야한다.</li>
<li>아래 소스는 <span style="color:#6298c1">Chrome</span> 브라우저에서 <strong><code>*</code>.mp4</strong> 및 <strong><code>*</code>.webm</strong> 포맷으로만 테스트되었습니다.</li>
</ul></li>
<li><p>Source Example</p>

<ul>
<li><p>Cliend Side(use JS)</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">vw</span> <span class="o">=</span> <span class="mi">327</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">vh</span> <span class="o">=</span> <span class="mi">125</span><span class="p">;</span>

<span class="c1">// video Element 를 가져온다.</span>
<span class="kd">var</span> <span class="nx">video</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;video&#39;</span><span class="p">);</span>
<span class="nx">video</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">vw</span><span class="p">;</span>
<span class="nx">video</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">vh</span><span class="p">;</span>

<span class="c1">// view(부호 없는 1byte 정수 배열)를 생성한다.</span>
<span class="kd">var</span> <span class="nx">uInt8Array</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">buffer</span><span class="p">);</span>

<span class="c1">// view를 통해 Blob Object 를 생성한다.</span>
<span class="kd">var</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">uInt8Array</span><span class="p">],</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;video/webm&#39;</span><span class="p">});</span>
<span class="c1">//var blob = new Blob([uInt8Array], {type: &#39;video/mp4&#39;});</span>

<span class="c1">// Blob Object를 참조하는 URL 를 생성한다.</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>

<span class="c1">// Blob 객체를 참조하는 URL을 video.src 에 할당 후 로드한다.</span>
<span class="nx">video</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
</code></pre></div></li>
<li><p>Server Side(use nodeJS)</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">&#39;redcliff450.webm&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">buf</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;onSocketMsg&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;resultVideoData&#39;</span><span class="p">,</span>
        <span class="nx">payload</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">buffer</span><span class="o">:</span> <span class="nx">buf</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></li>
</ul></li>
</ul></li>
<li><p><strong>Chunk 방식으로 내려받은 비디오 플레이</strong></p>

<ul>
<li>서버에서 Chunk 방식으로 내려받은 <span style="color:#6298c1">ArrayBuffer</span>(<strong>영상</strong> 데이터) 로 <span style="color:#c11f1f">view</span>(in Typed Array Views) 를 생성 후, 버퍼에 저장된 데이터를 조작한다.</li>
<li><span style="color:#6298c1">MediaSource API</span> 를 통해 내려받은 영상 데이터를 조작할 수 있다.</li>
<li><strong>영상</strong> 및 오디오 데이터의 경우, <span style="color:#c11f1f">브라우저 지원 여부</span> 및 <span style="color:#c11f1f">지원 포맷</span>에 대해 반드시 확인해봐야한다.</li>
<li>아래 소스는 <span style="color:#6298c1">Chrome</span> 브라우저에서 <strong><code>*</code>.webm</strong>(vorbis 및 vp8 코덱) 포맷으로만 테스트되었습니다.</li>
<li><p>Source Example</p>

<ul>
<li>Cliend Side(use JS)</li>
<li><p>저장소로 부터 내려받은 파일을 include 한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;socket.io-stream.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// stream 메서드에 socket 객체를 전달 후 해당 이벤트를 바인딩한다.</span>
<span class="nx">ss</span><span class="p">(</span><span class="nx">socket</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;onSocketMsg&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span> <span class="o">||</span> <span class="p">{};</span>

    <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">payload</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;resultChunkVideoData&#39;</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">vw</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">vh</span> <span class="o">=</span> <span class="mi">768</span><span class="p">;</span>

        <span class="c1">// video Element 를 가져온다.</span>
        <span class="kd">var</span> <span class="nx">video</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;video&#39;</span><span class="p">);</span>
        <span class="nx">video</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">vw</span><span class="p">;</span>
        <span class="nx">video</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">vh</span><span class="p">;</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">stream</span><span class="p">);</span> <span class="c1">// 내려받은 stream 데이터</span>

        <span class="c1">// MediaSource 객체를 생성한다.</span>
        <span class="kd">var</span> <span class="nx">ms</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MediaSource</span><span class="p">();</span>

        <span class="c1">// MediaSource 객체를 참조하는 URL 를 생성한다.</span>
        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">ms</span><span class="p">);</span>

        <span class="c1">// MediaSource 객체를 참조하는 URL을 video.src 에 할당 후 로드한다.</span>
        <span class="nx">video</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>

        <span class="c1">// MediaSource 객체에 각 이벤트를 바인딩 시킨다.</span>
        <span class="nx">ms</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;sourceopen&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="c1">// ms.addEventListener(&#39;webkitsourceopen&#39;, callback, false);</span>
        <span class="nx">ms</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;sourceended&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;mediaSource readyState: &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">readyState</span><span class="p">);</span>
        <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

        <span class="kd">function</span> <span class="nx">callback</span><span class="p">()</span> <span class="p">{</span>

            <span class="c1">// 재생하려는 영상 소스를 추가한다.</span>
            <span class="kd">var</span> <span class="nx">sourceBuffer</span> <span class="o">=</span> <span class="nx">ms</span><span class="p">.</span><span class="nx">addSourceBuffer</span><span class="p">(</span><span class="s1">&#39;video/webm; codecs=&quot;vp8&quot;&#39;</span><span class="p">);</span>
            <span class="c1">// var sourceBuffer = ms.addSourceBuffer(&#39;video/webm; codecs=&quot;vp8,vorbis&quot;&#39;);</span>

            <span class="nx">sourceBuffer</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;updatestart&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// console.log(&#39;updatestart: &#39; + ms.readyState);</span>
            <span class="p">});</span>

            <span class="nx">sourceBuffer</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="c1">// console.log(&#39;update: &#39; + ms.readyState);</span>
            <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

            <span class="nx">sourceBuffer</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;updateend&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;updateend: &#39;</span> <span class="o">+</span> <span class="nx">ms</span><span class="p">.</span><span class="nx">readyState</span><span class="p">);</span>
            <span class="p">});</span>
            <span class="nx">sourceBuffer</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error: &#39;</span> <span class="o">+</span> <span class="nx">ms</span><span class="p">.</span><span class="nx">readyState</span><span class="p">);</span>
            <span class="p">});</span>
            <span class="nx">sourceBuffer</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;abort&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;abort: &#39;</span> <span class="o">+</span> <span class="nx">ms</span><span class="p">.</span><span class="nx">readyState</span><span class="p">);</span>
            <span class="p">});</span>

            <span class="nx">payload</span><span class="p">.</span><span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>

                <span class="c1">// chunk data</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

                <span class="c1">// 버퍼에 내려받은 스트림 데이터를 할당한다.</span>
                <span class="nx">sourceBuffer</span><span class="p">.</span><span class="nx">appendBuffer</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

            <span class="p">});</span>

            <span class="c1">// 데이터 전송이 완료되었을 경우 발생한다.</span>
            <span class="nx">payload</span><span class="p">.</span><span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;endOfStream call&#39;</span><span class="p">);</span>
                <span class="c1">// 스트림을 종료한다.</span>
                <span class="nx">ms</span><span class="p">.</span><span class="nx">endOfStream</span><span class="p">();</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></li>
<li><p>Server Side(use nodeJS)</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">ss</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io-stream&#39;</span><span class="p">);</span>

<span class="nx">ss</span><span class="p">(</span><span class="nx">socket</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;onSocketMsg&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span> <span class="o">||</span> <span class="p">{};</span>

        <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">payload</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">stream</span> <span class="o">=</span> <span class="nx">ss</span><span class="p">.</span><span class="nx">createStream</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;downloadChunkVideo&#39;</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">// webm 포맷의 영상을 가져온다.</span>
            <span class="kd">var</span> <span class="nx">filename</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="s1">&#39;feelings_vp9-20130806-244.webm&#39;</span><span class="p">);</span>
            <span class="c1">// 파일 스트림을 생성한다.</span>
            <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">filename</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">stream</span><span class="p">);</span>

            <span class="nx">ss</span><span class="p">(</span><span class="nx">socket</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;onSocketMsg&#39;</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;resultChunkVideoData&#39;</span><span class="p">,</span>
                <span class="nx">payload</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">stream</span><span class="o">:</span> <span class="nx">stream</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
</code></pre></div></li>
<li><p>테스트 결과</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/bytesManipulation_11.jpg" alt=""></p></li>
</ul></li>
<li><p>참고 사이트</p>

<ul>
<li>Stream 모듈: <a href="https://github.com/nkzawa/socket.io-stream">socket.io-stream</a></li>
<li><a href="https://ko.wikipedia.org/wiki/WebM">WebM</a></li>
<li><a href="http://firejune.com/1788/%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EC%97%90%EC%84%9C%EC%9D%98+BLOB+%EA%B0%9D%EC%B2%B4?stext=blob">자바스크립트에서의 BLOB 객체</a></li>
<li><a href="http://html5-mediasource-api.googlecode.com/svn/tags/0.1/draft-spec/mediasource-draft-spec.html">Mediasource</a></li>
<li><a href="https://developer.mozilla.org/ko/docs/Web/API/MediaSource">MediaSource in MDN</a></li>
<li><a href="https://msdn.microsoft.com/en-us/library/dn254959(v=vs.85).aspx">MediaSource Object in MS</a></li>
<li><a href="https://msdn.microsoft.com/en-us/library/dn594470(v=vs.85).aspx">Media Source Extensions (MSE)</a></li>
<li><a href="https://html5-demos.appspot.com/static/media-source.html">Mediasource Chunk DEMO</a></li>
<li><a href="https://msdn.microsoft.com/ko-kr/library/Dn551368(v=VS.85).aspx">MPEG-DATA 스트리밍 플레이어 빌드 in MS</a></li>
<li><a href="https://simpl.info/video/offline/?1">simpl.info offline video</a></li>
<li><a href="http://megatuto.com/formation-HTML5.php?HTML5-Examples-Code=MediaSource+error:+This+SourceBuffer+has+been+removed+from+the+parent+media+source+Categorie+javascript+html5+media-source&amp;category=&amp;article=18543">MediaSource 소스 예제</a></li>
<li><a href="https://nodesource.com/blog/understanding-socketio">Socket IO Stream 코드 예제</a></li>
</ul></li>
</ul></li>
</ul>

        </article>
        <p style="text-align: right"><a href="/blog/javascript/2015/08/31/binary-inJS/">Read more</a></p>
        <hr style="margin-bottom:30px; border:0; border-bottom: 1px dotted #ccc;" />
    </li>
  
      <li>
          <header class="post-header">
            <h1 itemprop="name" class="post-title">
              <a itemprop="url" class="post-link" href="/blog/designpattern/2015/08/07/struct-inJS/">Struct in JS</a>
            </h1>
            <div class="tags cf">
              
                <a href="/blog/search/?category=designpattern">designpattern</a>&nbsp;
              
              <time itemprop="datePublished" datetime="2015-08-07">
                Aug 7, 2015
              </time>
            </div>
        </header>

        <article style="position: relative; width: 100%; height: 400px; overflow-y: hidden; margin-bottom: 15px;">
          <h2 id="1">1. 정의</h2>

<ul>
<li><p>C 와 C++(또는 C# 등) 에서 <strong>구조화 된 데이터</strong>를 처리할 때, <strong>Struct</strong> 를 사용하는데 이를 <a href="https://ko.wikipedia.org/wiki/Struct">구조체</a>라 부른다.</p>

<ul>
<li><p>최초의 <strong>구조체</strong>는 C 언어에서 다양한 <strong>자료구조</strong>를 하나의 <strong>집합</strong>으로 만들어 <strong>관리</strong>하기위해 만들어졌다.</p>

<ul>
<li>구조체는 하나 이상의 <strong>자료구조</strong>를 가진 또 하나의 <strong>데이터 타입</strong>을 정의한다.</li>
</ul></li>
<li><p>이 글은 <strong>구조체</strong>를 다루는 여러 언어 중 <code>[C# 구조체]</code> 를 기준으로 하고있다.</p></li>
</ul>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/struct_diagram.jpg?2" alt="">
- 코드화</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">public</span> <span class="nx">struct</span> <span class="nx">Song</span>
<span class="p">{</span>
    <span class="kr">public</span> <span class="kr">int</span> <span class="nx">lengthInSeconds</span><span class="p">,</span> <span class="nx">yearRecorded</span><span class="p">;</span>

    <span class="c1">// 생성자</span>
    <span class="kr">public</span> <span class="nx">Song</span><span class="p">(</span><span class="kr">int</span> <span class="nx">p1</span><span class="p">,</span> <span class="kr">int</span> <span class="nx">p2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">lengthInSeconds</span> <span class="o">=</span> <span class="nx">p1</span><span class="p">;</span>
        <span class="nx">yearRecorded</span> <span class="o">=</span> <span class="nx">p2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">TestSong</span>
<span class="p">{</span>
    <span class="kr">static</span> <span class="k">void</span> <span class="nx">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Initialize:</span>
        <span class="c1">// 생성된 객체는 Stack 메모리에 객체가 할당된다.</span>
        <span class="nx">Song</span> <span class="nx">song1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Song</span><span class="p">(</span><span class="mi">213</span><span class="p">,</span> <span class="mi">1994</span><span class="p">);</span>
        <span class="nx">Song</span> <span class="nx">song2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Song</span><span class="p">(</span><span class="mi">248</span><span class="p">,</span> <span class="mi">1988</span><span class="p">);</span>

        <span class="c1">// Display results:</span>
        <span class="nx">Console</span><span class="p">.</span><span class="nx">WriteLine</span><span class="p">(</span><span class="s2">&quot;lengthInSeconds = {0}, yearRecorded = {1}&quot;</span><span class="p">,</span> <span class="nx">song1</span><span class="p">.</span><span class="nx">lengthInSeconds</span><span class="p">,</span> <span class="nx">song1</span><span class="p">.</span><span class="nx">yearRecorded</span><span class="p">);</span>

        <span class="nx">Console</span><span class="p">.</span><span class="nx">WriteLine</span><span class="p">(</span><span class="s2">&quot;lengthInSeconds = {0}, yearRecorded = {1}&quot;</span><span class="p">,</span> <span class="nx">song2</span><span class="p">.</span><span class="nx">lengthInSeconds</span><span class="p">,</span> <span class="nx">song2</span><span class="p">.</span><span class="nx">yearRecorded</span><span class="p">);</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Output:</span>
<span class="cm">    lengthInSeconds = 213, yearRecorded = 1994</span>
<span class="cm">    lengthInSeconds = 248, yearRecorded = 1988</span>
<span class="cm">*/</span>
</code></pre></div>
<ul>
<li><p><strong>구조체</strong>는 <strong>Class</strong> 와 같이 여러 특성(생성자, 상수, 필드, 메서드, 속성, 인덱서, 연산자, 이벤트 등)들을 <strong>그룹화</strong> 하는데 사용된다.</p>

<ul>
<li><strong>구조체</strong>와 <strong>클래스</strong>는 매우 비슷한 <strong>구조</strong>를 가지고 있으며, <u><strong>사용 방법</strong> 및 <strong>적용 이유</strong></u>가 유사하다.</li>
</ul></li>
</ul></li>
</ul>

<h2 id="2-c">2. C# 구조체의 특징</h2>

<ul>
<li><p><code>값 타입</code>이다.</p>

<ul>
<li><a href="https://msdn.microsoft.com/ko-kr/library/4d43ts61(v=vs.90).aspx">값 형식 및 참조 형식</a></li>
<li><p>[Six important .NET concepts: Stack, heap, value types, reference types, boxing, and unboxing]</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/memoryDiagram.jpg?2" alt=""></p>

<ul>
<li><a href="http://www.codeproject.com/Articles/76153/Six-important-NET-concepts-Stack-">http://www.codeproject.com/Articles/76153/Six-important-NET-concepts-Stack-</a></li>
</ul></li>
</ul></li>
<li><p>생성된 객체는 <strong>Stack</strong> 메모리에 할당된다.</p></li>
<li><p><strong>구조체</strong>는 보통 <u>작은 데이터</u>를 다루는데 <strong>적합</strong>하다.</p>

<ul>
<li><p>하지만 <strong>이것</strong>을 <strong>클래스</strong>로 <span style="color:#c11f1f">표현할 수 없는 것</span>은 아니다.(그냥 작은 Class를 만들면 그만이다;;)</p>

<ul>
<li><em>그럼에도 불구하고 <code>구조체</code>를 써야하는 이유는 <u>분명 존재</u>할 것이다.</em></li>
</ul></li>
</ul></li>
<li><p><strong>new</strong> 연산자를 사용하지 않고도 <strong>인스턴스화</strong>할 수 있다.</p>

<ul>
<li>하지만 <u><strong>생성자</strong>를 호출하지 않으므로</u>, 선언된 맴버를 따로 <strong>초기화</strong> 해야하는 <span style="color:#c11f1f">불편함</span>이 존재한다.</li>
</ul>
<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">struct</span> <span class="nc">Song</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">lengthInSeconds</span><span class="p">,</span> <span class="n">yearRecorded</span><span class="p">;</span>

    <span class="c1">// 생성자</span>
    <span class="k">public</span> <span class="nf">Song</span><span class="p">(</span><span class="kt">int</span> <span class="n">p1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">lengthInSeconds</span> <span class="p">=</span> <span class="n">p1</span><span class="p">;</span>
        <span class="n">yearRecorded</span> <span class="p">=</span> <span class="n">p2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">TestSongNoNew</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// new 연산자 없이 인스턴스를 생성한다.</span>
        <span class="c1">// Stack 메모리에 객체가 할당된다.</span>
        <span class="c1">// 생성자를 호출하지 않는다.</span>
        <span class="n">Song</span> <span class="n">song1</span><span class="p">;</span>

        <span class="c1">// 속성 초기화</span>
        <span class="n">song1</span><span class="p">.</span><span class="n">lengthInSeconds</span> <span class="p">=</span> <span class="m">213</span><span class="p">;</span>
        <span class="n">song1</span><span class="p">.</span><span class="n">yearRecorded</span> <span class="p">=</span> <span class="m">1994</span><span class="p">;</span>

        <span class="c1">// Display results:</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;lengthInSeconds = {0}, yearRecorded = {1}&quot;</span><span class="p">,</span> <span class="n">song1</span><span class="p">.</span><span class="n">lengthInSeconds</span><span class="p">,</span> <span class="n">song1</span><span class="p">.</span><span class="n">yearRecorded</span><span class="p">);</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Output:</span>
<span class="cm">    lengthInSeconds = 213, yearRecorded = 1994</span>
<span class="cm">*/</span>
</code></pre></div></li>
<li><p><strong>구조체</strong>는 <strong>구조체</strong> 또는 <strong>클래스</strong>에서 <u>상속될 수 없으며</u>, 클래스의 기본 클래스가 될 수 없다.</p>

<ul>
<li><strong>클래스</strong>와 달리, 상속 구조를 구현할 수 없다.</li>
</ul></li>
<li><p><strong>클래스</strong>와 같이 <u><strong>인터페이스</strong>를 구현할 수 있다.</u></p></li>
<li><p>구조체는 <strong>Stack</strong> 영역에 할당되는 <strong><span style="color:#c11f1f">값 타입</span></strong>이고, 클래스는 <strong>Heap</strong> 영역에 할당되는 <strong><span style="color:#c11f1f">참조 타입</span></strong>이다.</p>

<ul>
<li><p><strong>Stack</strong> 영역(<span style="color:#c11f1f">정적 할당</span>)이란?</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/struct_stack.jpg" alt=""></p></li>
<li><p><strong>Stack</strong> 영역은 <strong>컴파일 시점</strong>에서 크기가 <strong>결정</strong>되는 요소들이 저장되는 <strong>메모리 영역</strong>이다.</p>

<ul>
<li>함수 내부 <strong>지역 변수</strong> 와 <strong>매개 변수</strong>는 <strong>Stack</strong> 영역에 할당되며, 함수 종료 시 <strong>소멸</strong>된다.</li>
</ul></li>
<li><p><strong>Stack</strong> 영역은 <strong>LIFO</strong>(Last In First out)라는 <strong>자료구조</strong> 가진다.</p>

<ul>
<li><p><em>즉 마지막에 넣은(Push) 데이터가 <code>가장 먼저</code> 나가는것을(Pop) 의미한다.</em></p>

<ul>
<li><p>Stack Push 순서:</p>

<ul>
<li>A &gt; B &gt; C &gt; D &gt; E</li>
</ul></li>
<li><p>Stack Pop 순서:</p>

<ul>
<li>E &gt; D &gt; C &gt; B &gt; A</li>
</ul></li>
</ul></li>
<li><p>그럼 <strong>JS Stack</strong> 은?</p>

<ul>
<li><p>JS 는 <a href="https://ko.wikipedia.org/wiki/%EB%8F%99%EC%A0%81_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_%EC%96%B8%EC%96%B4"><strong>동적 언어</strong></a> 이므로 <strong>컴파일 시점</strong>이 아닌 <strong>런타임 시점</strong>에서 메모리가 <strong>할당</strong>(allocation)된다.</p>

<ul>
<li>C, C++, C#(<strong>정적 언어</strong>)</li>
</ul></li>
<li><p>JS <strong>원시 타입</strong>(string, number, boolean, undefined, null)은 <strong>고정된 크기</strong>를 가지며, <strong>Stack</strong> 메모리 영역에 할당된다.</p></li>
<li><p>JS 의 모든 <strong>실행 컨텍스트</strong>는 <span style="color:#c11f1f">ECStack</span>(일종의 <a href="https://ko.wikipedia.org/wiki/%EC%BD%9C_%EC%8A%A4%ED%83%9D">Call Stack</a>) 내부로 할당된다.</p>

<ul>
<li><p>아래와 같은 방법으로 <code>ECStack Count</code> 를 셀 수 있다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">getStackCount</span><span class="p">(){</span>

    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">try</span><span class="p">{</span>
        <span class="p">(</span><span class="kd">function</span> <span class="nx">_stack</span><span class="p">(){</span>

            <span class="o">++</span><span class="nx">i</span> <span class="o">&amp;&amp;</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">();</span>
        <span class="p">})();</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// get call stack count</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;call stack count: &#39;</span> <span class="o">+</span> <span class="nx">getStackCount</span><span class="p">());</span>

<span class="cm">/* output</span>

<span class="cm"> Maximum call stack size exceeded</span>

<span class="cm"> // 15,745 번 함수 호출 후 Stack overflow 가 발생했다.</span>
<span class="cm"> call stack count: 15745</span>

<span class="cm"> */</span>
</code></pre></div></li>
</ul></li>
</ul></li>
</ul></li>
<li><p><strong>Heap</strong> 영역(<span style="color:#c11f1f">동적 할당</span>)이란?</p>

<ul>
<li><p><strong>Heap</strong> 영역은 <strong>런타임 시점</strong>에서 크기가 <strong>결정</strong>되는 요소들이 저장되는 <strong>메모리 영역</strong>이다.</p>

<ul>
<li>Object 또는 Array Data Type 등을 가진다.</li>
</ul></li>
<li><p><strong>Heap</strong> 영역은 <strong>런타임 시점</strong>에서 메모리를 <u><strong>가변적</strong>으로 <strong>동적</strong> <span style="color:#c11f1f">할당</span> 및 <span style="color:#c11f1f">반환</span>(GC를 통해) 시키는 구조</u>를 가진다.</p></li>
<li><p><strong>GC</strong>는 <strong>할당</strong>된 <strong>Heap</strong> 메모리 영역의 <span style="color:#c11f1f">반환</span>(de-allocated(수거))을 담당한다.</p>

<ul>
<li><p><strong>GC</strong>(Garbage Collection)란?</p>

<ul>
<li><strong>자동 메모리 관리</strong>의 한 형태이며, 프로세스 수행 중, 더 이상 필요가 없어진 <strong>객체</strong>가 점유하는 <u>메모리에 대해 <span style="color:#c11f1f">반환</span> 작업을 수행</u>한다.</li>
<li>프로그래머가 직접 메모리를 <span style="color:#c11f1f">반환</span>할 수는 없다.(반드시 <code>GC</code>를 통해 반환된다)</li>
<li><p>단 GC에게 메모리 <u><strong>반환</strong> 조건</u>을 만들어 줄 수는 있다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span><span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span><span class="p">};</span>

<span class="c1">// GC에게 메모리 반환 조건을 만들어 준다.</span>
<span class="nx">obj</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</code></pre></div></li>
</ul></li>
</ul></li>
</ul></li>
<li><p>JS <strong>Heap</strong> 메모리 영역 테스트 해보기!!</p>

<ul>
<li><p>V8 <strong>Handle scope</strong> Diagram</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/handleV8.jpg" alt=""></p></li>
<li><p>아래 코드는 <strong>Heap</strong> 메모리 영역에 <strong>객체</strong>를 <span style="color:#c11f1f">할당</span>하는 예제이다.</p></li>
</ul>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global execution context</span>

<span class="c1">// 전역 실행 컨텍스트에서 함수 객체를 하나 선언한다.</span>

<span class="c1">// 선언된 함수 객체는 Heap 메모리 영역에 할당된다.</span>
<span class="kd">function</span> <span class="nx">globalA</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">init</span><span class="p">(){</span>

    <span class="c1">// _global 전역 변수에 생성된 인스턴스를 할당한다.</span>
    <span class="c1">// 이때 전역 변수(참조 변수)는 Heap 메모리 영역에 할당된 객체를 참조하게된다.</span>

    <span class="nx">_global</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">globalA</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">init</span><span class="p">();</span>
</code></pre></div>
<ul>
<li><p><strong>전역 실행 컨텍스트</strong>에서 선언된 <strong>globalA</strong> 함수 객체의 <strong>Heap</strong> 메모리 영역.</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/heapSnapShot0.jpg" alt=""></p></li>
<li><p><strong>_global</strong> 전역 변수가 참조하는 <strong>객체</strong>의 <strong>Heap</strong> 메모리 영역.</p>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/heapSnapShot1.jpg" alt=""></p></li>
<li><p><span style="color:#c11f1f">Chrome Inspector</span>를 통해 할당된 <strong>Heap 메모리 영역</strong>을 살펴볼 수 있다.</p>

<ul>
<li><a href="http://stackoverflow.com/questions/20697298/understanding-chrome-heap-profile">understanding chrome heap profile</a></li>
</ul></li>
<li><p>만약 함수 <strong>지역 변수</strong>에 <strong>객체</strong>를 할당했다면, 그 객체(<strong>Heap</strong> 영역)의 메모리 <strong><span style="color:#c11f1f">반환</span></strong> <strong>시점</strong>은 언제일까?</p>

<ul>
<li><p><em>결론: <code>지역 변수</code>에 할당된 객체 메모리 <span style="color:#c11f1f">반환</span> 시점은 <u></em><em>함수 종료 시점</em><em></u>이 된다.</em></p>

<ul>
<li><p>테스트 1: <code>전역 변수</code>와 함수 <code>지역 변수</code>에 동일한 <code>객체</code>를 할당해본 후 <code>Profile</code> 을 통해 <code>Heap</code> 영역을 관찰해본다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// global execution context</span>

<span class="c1">// 전역 실행 컨텍스트에서 함수 객체를 하나 선언한다.</span>

<span class="c1">// 선언된 함수 객체는 Heap 메모리 영역에 할당된다.</span>
<span class="kd">function</span> <span class="nx">globalA</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">init</span><span class="p">(){</span>

    <span class="c1">// _district 지역 변수에 생성된 인스턴스를 할당한다.</span>
    <span class="c1">// 이때 지역 변수(참조 변수)는 Heap 메모리 영역에 할당된 객체를 참조하게된다.</span>

    <span class="c1">// 단 지역 변수에 할당된 객체의 &quot;메모리 반환 시점&quot;은, 함수 종료 시점(함수 실행 컨텍스트 종료 시점)이 된다.</span>

    <span class="kd">var</span> <span class="nx">_district</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">globalA</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">init</span><span class="p">();</span>
</code></pre></div></li>
<li><p><code>지역 변수</code>에 할당된 <code>객체</code>는 <code>Heap</code> 메모리 영역에서 <span style="color:#c11f1f">반환</span>되어 보이지 않는다.</p></li>
</ul>

<p><img src="http://mohwa.github.io/blog/assets/images/posts/heapSnapShot2.jpg" alt=""></p></li>
</ul></li>
</ul></li>
</ul></li>
</ul>

<h2 id="3-js-struct">3. JS 로 Struct 구현해보기</h2>

<ul>
<li><p>위에서 나열한 <strong>구조체</strong>의 <strong>특징</strong> 중 <strong>클래스</strong>와 <strong>본질</strong>적으로 다른 부분인, <u><strong>데이터 생성</strong></u>에 대한 부분을 JS 를 통해 구현해 보았다.</p>

<ul>
<li>구조체: <strong>값</strong> 타입(<strong>Stack</strong> 메모리 영역에 할당되며, 값이 <span style="color:#c11f1f">복사</span>되어 할당된다)</li>
<li>클래스: <strong>참조</strong> 타입(<strong>Heap</strong> 메모리 영역에 할당되며, <span style="color:#c11f1f">참조</span> 값이 할당된다)</li>
</ul></li>
<li><p><code>구조체</code>의 특징 중 극히 일부를 구현한것이며, 타 언어에서 구현된 구조체라 할 수는 없다.</p></li>
</ul>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">Struct</span><span class="p">(</span><span class="nx">val</span><span class="p">){</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="k">typeof</span> <span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">||</span>
        <span class="k">typeof</span> <span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span> <span class="o">||</span>
        <span class="k">typeof</span> <span class="nx">val</span> <span class="o">===</span> <span class="s1">&#39;boolean&#39;</span> <span class="o">||</span>
        <span class="nx">val</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span>
        <span class="nx">val</span> <span class="o">===</span> <span class="kc">undefined</span>
    <span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;primitive type value: &#39;</span> <span class="o">+</span> <span class="nx">val</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">_copy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">){</span>

        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">constructor</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">constructor</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">constructor</span> <span class="o">===</span> <span class="nb">Function</span><span class="p">){</span>

            <span class="c1">// 함수(상황에 따라 생성자 함수가 될 수도 있다) 객체 내부 this 값을 apply 함수를 통해 초기화 시키고, 그 결과를 반환하는 함수를 생성한다.</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">$F</span><span class="p">(){</span>

                <span class="c1">// this === global or $F of instance object</span>
                <span class="k">return</span> <span class="nx">val</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
            <span class="p">};</span>

            <span class="c1">// 전달된 함수 객체의 prototype(객체 원형)을 할당한다.</span>
            <span class="nx">ret</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">constructor</span> <span class="o">===</span> <span class="nb">String</span> <span class="o">||</span> <span class="nx">constructor</span> <span class="o">===</span> <span class="nb">Number</span> <span class="o">||</span> <span class="nx">constructor</span> <span class="o">===</span> <span class="nb">Boolean</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">constructor</span><span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">constructor</span> <span class="o">===</span> <span class="nb">Date</span><span class="p">){</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">constructor</span><span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">getTime</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">constructor</span> <span class="o">===</span> <span class="nb">Object</span> <span class="o">||</span> <span class="nx">constructor</span> <span class="o">===</span> <span class="nb">Array</span><span class="p">){</span>

            <span class="nx">ret</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">constructor</span><span class="p">();</span>

            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">n</span> <span class="k">in</span> <span class="nx">val</span><span class="p">){</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">n</span><span class="p">)){</span>
                    <span class="nx">ret</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">[</span><span class="nx">n</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>

    <span class="p">}(</span><span class="nx">val</span><span class="p">)</span> <span class="o">||</span> <span class="nx">val</span><span class="p">;</span>


    <span class="k">return</span> <span class="nx">_copy</span><span class="p">;</span>
<span class="p">}</span>

    <span class="c1">// 5 가지의 원시 타입 값 할당</span>
<span class="nx">Struct</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span> <span class="c1">// test</span>
<span class="nx">Struct</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 1</span>
<span class="nx">Struct</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> <span class="c1">// true</span>
<span class="nx">Struct</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span> <span class="c1">// undefined</span>
<span class="nx">Struct</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span> <span class="c1">// null</span>

<span class="cm">/*</span>
<span class="cm">    모든 경우(모든 타입)에 전달된 원본 값(객체)이 아닌 복사 된 값을 반환한다.</span>
<span class="cm">*/</span>

<span class="cm">/*</span>
<span class="cm"> 함수 객체 선언</span>
<span class="cm"> */</span>
<span class="kd">var</span> <span class="nx">$$</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">$$</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">_$$</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">_$$</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 나를통해 생성될 객체 원형에 새로운 객체를 할당한다.</span>
    <span class="nx">_$$</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">getX</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">$$</span><span class="p">.</span><span class="nx">staticMethod</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>

    <span class="k">return</span> <span class="nx">$$</span><span class="p">;</span>
<span class="p">}();</span>

<span class="cm">/*</span>
<span class="cm"> 다른 유형의 함수 객체 선언</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">Plus</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">){</span>

    <span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">originalFn</span> <span class="o">=</span> <span class="nx">$$</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">structFn</span> <span class="o">=</span> <span class="nx">Struct</span><span class="p">(</span><span class="nx">$$</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">originalFn</span><span class="p">);</span> <span class="c1">// function</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">structFn</span><span class="p">);</span> <span class="c1">// function</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">originalFn</span><span class="p">());</span> <span class="c1">// object</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">structFn</span><span class="p">());</span> <span class="c1">// object</span>

<span class="kd">var</span> <span class="nx">originalFn1</span> <span class="o">=</span> <span class="nx">Plus</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">structFn1</span> <span class="o">=</span> <span class="nx">Struct</span><span class="p">(</span><span class="nx">Plus</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">originalFn1</span><span class="p">);</span> <span class="c1">// function</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">structFn1</span><span class="p">);</span> <span class="c1">// function</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">originalFn1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span> <span class="c1">// 4</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">structFn1</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span> <span class="c1">// 5</span>

<span class="kd">var</span> <span class="nx">structStr</span> <span class="o">=</span> <span class="nx">Struct</span><span class="p">(</span><span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">));</span>
<span class="kd">var</span> <span class="nx">structNum</span> <span class="o">=</span> <span class="nx">Struct</span><span class="p">(</span><span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">structStr</span><span class="p">);</span> <span class="c1">// string object</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">structNum</span><span class="p">);</span> <span class="c1">// number object</span>

<span class="kd">var</span> <span class="nx">structObject</span> <span class="o">=</span> <span class="nx">Struct</span><span class="p">({</span><span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">2</span><span class="p">});</span>
<span class="kd">var</span> <span class="nx">structArray</span> <span class="o">=</span> <span class="nx">Struct</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">structObject</span><span class="p">);</span> <span class="c1">// object</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">structArray</span><span class="p">);</span> <span class="c1">// array</span>

<span class="kd">var</span> <span class="nx">structBoolean</span> <span class="o">=</span> <span class="nx">Struct</span><span class="p">(</span><span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">structBoolean</span><span class="p">);</span> <span class="c1">// boolean object</span>


<span class="kd">var</span> <span class="nx">structDate</span> <span class="o">=</span> <span class="nx">Struct</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">structDate</span><span class="p">);</span> <span class="c1">// date object</span>
</code></pre></div>
<h2 id="4">4. 정리하며</h2>

<ul>
<li><p>그럼 언제 사용하면될까?</p>

<ul>
<li><p>개인적인 생각으로는 이럴때가 아닌가 싶다?</p>

<ul>
<li><p>클래스로 만들기에는 너무 간단한 구조인 경우.</p>

<ul>
<li><p>사실 이 경우, 반드시 <strong>구조</strong> 만의 문제는 아닐 수 있다.</p>

<ul>
<li>만약 모든 경우에 <strong>클래스</strong>를 사용한다면, 위에서 언급한 봐와같이 <strong>객체</strong>는 <strong>Heap</strong> 영역에 <span style="color:#c11f1f">할당</span>될 것이며, 결국 <strong>GC</strong> 는 그 메모리 <strong>반환</strong>을 위해 쓸때 없는 리소스를 <strong>낭비</strong>하게 될 것이다.</li>
</ul></li>
</ul></li>
<li><p><strong>상속 구조</strong>를 만들 필요가 없는 경우.</p></li>
</ul></li>
<li><p>하지만, 이 두 가지 특징 모두 <strong><span style="color:#c11f1f">각 언어</span></strong>(C/C++/C# 등 구조체를 가진 모든 언어)가 가지는 <strong><span style="color:#c11f1f">특성</span></strong>에 따라 충분히 변할 수 있는 부분이므로 모든 언어에 <strong>적용</strong>된다고 말할 수는 없다.</p>

<ul>
<li><em>간단히 말해, 특정 <code>언어</code>가 <code>구조체</code>를 어떤 방식으로 <code>구현</code>하느냐에 따라, <code>사용 범위</code>도 크게 달라질 수 있다는 말과 같다.</em></li>
</ul></li>
</ul></li>
</ul>

<h2 id="5-url">5. 참고 URL</h2>

<ul>
<li><p><a href="https://msdn.microsoft.com/ko-kr/library/0taef578.aspx">C# 구조체 설명</a></p></li>
<li><p><a href="https://msdn.microsoft.com/ko-kr/library/0b0thckt.aspx">C# 클래스 설명</a></p></li>
<li><p><a href="http://stackoverflow.com/questions/13266616/primitive-value-vs-reference-value">primitive value vs reference value</a></p></li>
<li><p><a href="http://codingnuri.com/javascript-tutorial/javascript-primitive-types-and-reference-types.html">원시 타입과 참조 타입</a></p></li>
<li><p><a href="https://msdn.microsoft.com/ko-kr/library/4d43ts61(v=vs.90).aspx">값 형식 및 참조 형식(Visual C# Express)</a></p></li>
<li><p><a href="http://davidshariff.com/blog/what-is-the-execution-context-in-javascript/">What is the Execution Context &amp; Stack in JavaScript?</a></p></li>
<li><p><a href="http://stackoverflow.com/questions/11148353/javascript-scope-and-execution-context">javascript-scope-and-execution-context</a>=</p></li>
<li><p><a href="http://dsnight.tistory.com/50">C언어의 메모리 구조</a></p></li>
<li><p><a href="http://egloos.zum.com/recipes/v/5057426">STACK, HEAP에 관한 소고</a></p></li>
<li><p><a href="https://kldp.org/node/44714">도대체 [구조체]가 [클래스]보다 좋은점이 뭔가요?</a></p>

<ul>
<li><em>개인적으로 이런 글을 좋아한다.(다양한 생각들을 들을 수 있으며, 그로인해 많은 <code>영감</code>을 얻기도 한다)</em></li>
</ul></li>
<li><p><a href="https://opentutorials.org/course/1720/9735">메모리 구조</a></p></li>
<li><p><a href="http://adibong.tistory.com/169">프로그램과 메모리 , 스택과 힙</a></p></li>
</ul>

        </article>
        <p style="text-align: right"><a href="/blog/designpattern/2015/08/07/struct-inJS/">Read more</a></p>
        <hr style="margin-bottom:30px; border:0; border-bottom: 1px dotted #ccc;" />
    </li>
  
      <li>
          <header class="post-header">
            <h1 itemprop="name" class="post-title">
              <a itemprop="url" class="post-link" href="/blog/designpattern/2015/08/07/interface-inJS/">Interface in JS</a>
            </h1>
            <div class="tags cf">
              
                <a href="/blog/search/?category=designpattern">designpattern</a>&nbsp;
              
              <time itemprop="datePublished" datetime="2015-08-07">
                Aug 7, 2015
              </time>
            </div>
        </header>

        <article style="position: relative; width: 100%; height: 400px; overflow-y: hidden; margin-bottom: 15px;">
          <h2 id="1">1. 정의</h2>

<ul>
<li>가장 큰 범위의 <a href="https://ko.wikipedia.org/wiki/%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4">인터페이스</a> <code>정의</code>는 사물 간 또는 사물과 인간 간(<a href="https://ko.wikipedia.org/wiki/%EC%82%AC%EC%9A%A9%EC%9E%90_%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4">User Interface</a>)의 의사소통을 위한 중간 <span style="color:#c11f1f">매개체</span>다. 즉 서로간의 의사소통을 위해 정해진 약속이 존재하며, 이를 <code>표준 규격</code> 이라 말할 수 있는것이다.</li>
</ul>

<h2 id="2">2. 의미</h2>

<p><img src="/blog/assets/images/posts/interface_diagram.png" alt=""></p>

<ul>
<li><p><strong>인터페이스</strong>(<code>DB Interface</code>):</p>

<ul>
<li><p><strong>구현 클래스</strong>가 공통적으로 가져야할 필수 <span style="color:#c11f1f">특성</span>(connect, disconnect 등)들을 <strong>선언</strong>함으로써, 해당 구현 클래스들에게 <strong>사용자</strong>(<code>User Class</code>)와의 <strong>의사 소통</strong> 방침(<span style="color:#c11f1f">표준 규격</span>)을 알리는데 목적이 있다.</p>

<ul>
<li>[x] <em>인터페이스 내부에 선언된 모든 특성은 구현 클래스를 통해 반드시 구현되어야 한다.</em></li>
</ul></li>
</ul></li>
<li><p><strong>구현 클래스</strong>(<code>MSSQL, ORACLE API Class 등</code>):</p>

<ul>
<li><p>사용자(<code>User Class</code>)와의 의사소통을 위해 인터페이스 내부에 선언된 모든 특성들을 충실히 구현한다.</p>

<ul>
<li><p><em>이때 <code>사용자</code> 입장에서는 특정 구현 클래스 <code>명세</code> 없이도, 인터페이스 명세에 따라 제공받은 모든 API 를 사용할 수 있다는 장점이 존재한다.</em></p>

<ul>
<li>[x] <em>정확히 말하자면, 특정 API 의 모든 기능이 아닌 인터페이스를 구현한 기능에 한정된다.</em></li>
</ul></li>
</ul></li>
</ul></li>
</ul>

<h2 id="3">3. 상황에 따른 의미</h2>

<ul>
<li><p>만약 운영중인 어플리케이션의 DB 플랫폼이 <strong>MSSQL</strong> 에서 <strong>PostgreSQL</strong> 로 변경된다고 가정해보자.(오랜 기간 운영중인 어플리케이션의 경우 이런저런 이유로 이와 같은 상황이 충분히 올 수 있다)</p>

<p>이때 위 다이어그과 같은 <code>인터페이스 설계</code>가 되어있는 상태라면, <strong>PostgreSQL</strong> 규격에 따라, 구현 클래스만 작성하면 최소 비용으로 기능을 <span style="color:#c11f1f">확장</span>할 수 있을 것이다.</p>

<ul>
<li><em>또 <code>사용자 입장</code>에서보면, 인터페이스를 통해 구현된, 공통적인 기능 만큼은 기존 코드를 <span style="color:#c11f1f">재사용</span>할 수 있다는 큰 장점까지 갖게 되는 것이다.(어플리케이션 유지보수 비용 최소화)</em></li>
</ul></li>
</ul>

<h2 id="4-js">4. JS 로 인터페이스 구현해보기</h2>

<iframe width="100%" height="1000" src="http://jsfiddle.net/mohwa/jzu5r06e/3/embedded/js" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>인터페이스 <code>구현</code>은 아래 <strong>C# 인터페이스 가이드</strong>에 맞춰 구현되었으며, JS 코드에 대한 자세한 설명은 따로 하지 않겠다.(만약 JS 에 대해 어느정도 알고 있는 상황이라면, 코드를 분석해보길 권장한다)</p>

<ul>
<li><p>아래는 구현에 대한 간략한 설명이다.</p>

<ul>
<li><p>인터페이스 선언을 위한 인터페이스 함수 객체를 구현한다.</p>

<ul>
<li>인터페이스 [이벤트] 선언을 위해 <strong>Observer</strong> 기능을 구현한다.</li>
<li><a href="https://msdn.microsoft.com/ko-kr/library/awbftdfh.aspx">C# 이벤트 선언</a></li>
</ul></li>
<li><p>인터페이스를 상속받은 <strong>구현 클래스</strong>를 검증(상속받은 인터페이스를 모두 구현했는지에 대한 검증)하는 함수 객체(Interface.ensureImplement)를 구현한다.</p></li>
<li><p>위 다이어그램과 같이 <strong>인터페이스</strong> 및 각 <strong>클래스</strong>(구현 클래스)들을 구현한다.</p></li>
</ul></li>
<li><p><a href="https://msdn.microsoft.com/ko-kr/library/ms173156.aspx">C# 인터페이스</a>(인터페이스 <code>정의</code>는 각 언어마다 조금씩 차이를 보인다(모든 언어에 동일하게 구현되어있지 않다))</p></li>
</ul>

<h2 id="5">5. 정리하며</h2>

<ul>
<li><p><strong>인터페이스</strong>는 개발 중인 어플케이션 규모 및 설계에 따라 적용 범위가 얼마든지 달라질 수 있다.(또는 사용이 불필요할 수 도 있다(간혹 팀내에서의 <strong>관행</strong>적인 적용이 있다는 말을 들은적이 있는데 이건 정말 아닌듯 하다;;;))</p>

<ul>
<li><em>너무 당연한 말일 수 도 있지만, 인터페이스와 같은 모든 디자인 패턴은 적재 적소에 활용해야만 득이되는 것이다.</em></li>
</ul></li>
<li><p>위에서 언급한 내용과 다른 <strong>적용 사례</strong>에 대해(<em>인터페이스를 구현하는 상황이 또 모가 있을까?) 한번쯤 심도있게 생각해보길 바란다</em></p></li>
</ul>

<h2 id="6-url">6. 참고 URL</h2>

<ul>
<li><p><a href="http://woonohyo.tistory.com/22">DI란?</a></p></li>
<li><p><a href="http://okky.kr/article/161248">인터페이스 사용이유</a></p></li>
<li><p><a href="http://masamune.tistory.com/16">인터페이스란</a></p></li>
<li><p><a href="https://msdn.microsoft.com/ko-kr/library/tkyhsw31.aspx">C# 인터페이스 인덱서</a></p></li>
<li><p><a href="https://msdn.microsoft.com/ko-kr/library/64syzecx.aspx">C# 인터페이스 속성</a></p></li>
<li><p><a href="https://msdn.microsoft.com/ko-kr/library/ak9w5846.aspx">C# 인터페이스 이벤트</a></p></li>
</ul>

        </article>
        <p style="text-align: right"><a href="/blog/designpattern/2015/08/07/interface-inJS/">Read more</a></p>
        <hr style="margin-bottom:30px; border:0; border-bottom: 1px dotted #ccc;" />
    </li>
  
  </ul>
</section>
<section class="pagination">
  <!-- Pagination links -->
  <ul class="pagination clearfix">
    
    
    <li><a href="/blog/page2">Prev</a></li>
    
    
    
    <li><a href="/blog/">1</a></li>
    
    
    
    <li><a href="/blog/page2">2</a></li>
    
    
    
    <li><span class="active">3</span></li>
    
    
    
    <li><span class="disabled">Next</span></li>
    
</ul>

</section>

      <div class="separator"></div>
    </div>
  </div>
  <footer>
    <section>
  <ul class="links">
      <li><a href="https://twitter.com/yanione" title="follow me" target="_blank"><i class="icon-twitter"></i></a></li>
      <li><a href="https://github.com/mohwa" title="github page" target="_blank"><i class="icon-github"></i></a></li>
  </ul>
<section>

  </footer>
  <script>
    <!-- Google Analytics -->
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-30470280-2', 'auto');
    ga('send', 'pageview');

    // include jekyll full text search
    // https://github.com/christian-fei/Simple-Jekyll-Search
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('results-container'),
      json: '/blog/search.json',
      searchResultTemplate: '<li><a href="{href}">{title}</a>&nbsp;&nbsp;&nbsp;{date}</li>',
      noResultsText: 'No results found'
    });

  </script>
  <script src="http://b.readtrend.com/j/s.js"></script>
</body>
</html>
